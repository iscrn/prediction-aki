
-- LABEVENTS AND CHARTEVENTS FOR THE DCWs 

--72H 
DROP TABLE IF EXISTS FEATURES_ISA.BICARBONATE_72H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_BICARBONATE, MIN(L.VALUENUM) as MIN_BICARBONATE,
	MAX(L.VALUENUM) as MAX_BICARBONATE, COUNT(L.VALUENUM) as COUNT_BICARBONATE
INTO FEATURES_ISA.BICARBONATE_72H
FROM ISABELA.DCW72H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '72 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND    
	L.ITEMID = 50882 --BICARBONATE 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.BUN_72H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_BUN, MIN(L.VALUENUM) as MIN_BUN,
	MAX(L.VALUENUM) as MAX_BUN,
	COUNT(L.VALUENUM) as COUNT_BUN
INTO FEATURES_ISA.BUN_72H
FROM ISABELA.DCW72H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '72 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51006 --BLOOD UREA NITROGEN 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.CHLORIDE_72H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_CHLORIDE, MIN(L.VALUENUM) as MIN_CHLORIDE,
	MAX(L.VALUENUM) as MAX_CHLORIDE, COUNT(L.VALUENUM) as COUNT_CHLORIDE
INTO FEATURES_ISA.CHLORIDE_72H
FROM ISABELA.DCW72H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '72 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID in (50902, 50806)  -- CHLORIDE, 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.CREATININE_72H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_SCR, MIN(L.VALUENUM) as MIN_SCR,
	MAX(L.VALUENUM) as MAX_SCR, COUNT(L.VALUENUM) as COUNT_SCR
INTO FEATURES_ISA.CREATININE_72H
FROM ISABELA.DCW72H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '72 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 50912 --CREATININE, 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;
--25150

DROP TABLE IF EXISTS FEATURES_ISA.INR_72H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_INR, MIN(L.VALUENUM) as MIN_INR,
	MAX(L.VALUENUM) as MAX_INR, COUNT(L.VALUENUM) as COUNT_INR
INTO FEATURES_ISA.INR_72H
FROM ISABELA.DCW72H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '72 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51237 --INTERNATIONAL NORMALIZED RATIO 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.PLATELETS_72H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_PLATELETS, MIN(L.VALUENUM) as MIN_PLATELETS,
	MAX(L.VALUENUM) as MAX_PLATELETS, COUNT(L.VALUENUM) as COUNT_PLATELETS
INTO FEATURES_ISA.PLATELETS_72H
FROM ISABELA.DCW72H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '72 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51265 --PLATELETS
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.POTASSIUM_72H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_POTASSIUM, MIN(L.VALUENUM) as MIN_POTASSIUM,
	MAX(L.VALUENUM) as MAX_POTASSIUM, COUNT(L.VALUENUM) as COUNT_POTASSIUM
INTO FEATURES_ISA.POTASSIUM_72H
FROM ISABELA.DCW72H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '72 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID IN (50971, 50822) --POTASSIUM 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;
--25261

DROP TABLE IF EXISTS FEATURES_ISA.PTT_72H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_PTT, MIN(L.VALUENUM) as MIN_PTT,
	MAX(L.VALUENUM) as MAX_PTT, COUNT(L.VALUENUM) as COUNT_PTT
INTO FEATURES_ISA.PTT_72H
FROM ISABELA.DCW72H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '72 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51275 -- PARTIAL THROMBOBLASTIN TIME  
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;

DROP TABLE IF EXISTS FEATURES_ISA.WBC_72H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_WBC, MIN(L.VALUENUM) as MIN_WBC,
	MAX(L.VALUENUM) as MAX_WBC,  COUNT(L.VALUENUM) as COUNT_WBC
INTO FEATURES_ISA.WBC_72H
FROM ISABELA.DCW72H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '72 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID IN (51301, 51300)  --WHITE BLOOD COUNT
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.CALCIUM_72H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_CALCIUM, MIN(L.VALUENUM) as MIN_CALCIUM,
	MAX(L.VALUENUM) as MAX_CALCIUM, COUNT(L.VALUENUM) as COUNT_CALCIUM
INTO FEATURES_ISA.CALCIUM_72H
FROM ISABELA.DCW72H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '72 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 50893 -- CALCIUM
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


-- 96H LABEVENTS 
DROP TABLE IF EXISTS FEATURES_ISA.BICARBONATE_96H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_BICARBONATE, MIN(L.VALUENUM) as MIN_BICARBONATE,
	MAX(L.VALUENUM) as MAX_BICARBONATE, COUNT(L.VALUENUM) as COUNT_BICARBONATE
INTO FEATURES_ISA.BICARBONATE_96H
FROM ISABELA.DCW96H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '96 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND    
	L.ITEMID = 50882 --BICARBONATE 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.BUN_96H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_BUN, MIN(L.VALUENUM) as MIN_BUN,
	MAX(L.VALUENUM) as MAX_BUN,
	COUNT(L.VALUENUM) as COUNT_BUN
INTO FEATURES_ISA.BUN_96H
FROM ISABELA.DCW96H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '96 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51006 --BLOOD UREA NITROGEN 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.CHLORIDE_96H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_CHLORIDE, MIN(L.VALUENUM) as MIN_CHLORIDE,
	MAX(L.VALUENUM) as MAX_CHLORIDE, COUNT(L.VALUENUM) as COUNT_CHLORIDE
INTO FEATURES_ISA.CHLORIDE_96H
FROM ISABELA.DCW96H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '96 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID in (50902, 50806)  -- CHLORIDE, 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.CREATININE_96H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_SCR, MIN(L.VALUENUM) as MIN_SCR,
	MAX(L.VALUENUM) as MAX_SCR, COUNT(L.VALUENUM) as COUNT_SCR
INTO FEATURES_ISA.CREATININE_96H
FROM ISABELA.DCW96H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '96 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 50912 --CREATININE, 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;
--25150

DROP TABLE IF EXISTS FEATURES_ISA.INR_96H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_INR, MIN(L.VALUENUM) as MIN_INR,
	MAX(L.VALUENUM) as MAX_INR, COUNT(L.VALUENUM) as COUNT_INR
INTO FEATURES_ISA.INR_96H
FROM ISABELA.DCW96H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '96 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51237 --INTERNATIONAL NORMALIZED RATIO 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.PLATELETS_96H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_PLATELETS, MIN(L.VALUENUM) as MIN_PLATELETS,
	MAX(L.VALUENUM) as MAX_PLATELETS, COUNT(L.VALUENUM) as COUNT_PLATELETS
INTO FEATURES_ISA.PLATELETS_96H
FROM ISABELA.DCW96H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '96 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51265 --PLATELETS
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.POTASSIUM_96H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_POTASSIUM, MIN(L.VALUENUM) as MIN_POTASSIUM,
	MAX(L.VALUENUM) as MAX_POTASSIUM, COUNT(L.VALUENUM) as COUNT_POTASSIUM
INTO FEATURES_ISA.POTASSIUM_96H
FROM ISABELA.DCW96H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '96 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID IN (50971, 50822) --POTASSIUM 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;
--25261

DROP TABLE IF EXISTS FEATURES_ISA.PTT_96H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_PTT, MIN(L.VALUENUM) as MIN_PTT,
	MAX(L.VALUENUM) as MAX_PTT, COUNT(L.VALUENUM) as COUNT_PTT
INTO FEATURES_ISA.PTT_96H
FROM ISABELA.DCW96H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '96 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51275 -- PARTIAL THROMBOBLASTIN TIME  
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;

DROP TABLE IF EXISTS FEATURES_ISA.WBC_96H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_WBC, MIN(L.VALUENUM) as MIN_WBC,
	MAX(L.VALUENUM) as MAX_WBC,  COUNT(L.VALUENUM) as COUNT_WBC
INTO FEATURES_ISA.WBC_96H
FROM ISABELA.DCW96H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '96 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID IN (51301, 51300)  --WHITE BLOOD COUNT
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.CALCIUM_96H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_CALCIUM, MIN(L.VALUENUM) as MIN_CALCIUM,
	MAX(L.VALUENUM) as MAX_CALCIUM, COUNT(L.VALUENUM) as COUNT_CALCIUM
INTO FEATURES_ISA.CALCIUM_96H
FROM ISABELA.DCW96H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '96 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 50893 -- CALCIUM
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;

--120H
DROP TABLE IF EXISTS FEATURES_ISA.BICARBONATE_120H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_BICARBONATE, MIN(L.VALUENUM) as MIN_BICARBONATE,
	MAX(L.VALUENUM) as MAX_BICARBONATE, COUNT(L.VALUENUM) as COUNT_BICARBONATE
INTO FEATURES_ISA.BICARBONATE_120H
FROM ISABELA.DCW120H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '120 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND    
	L.ITEMID = 50882 --BICARBONATE 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.BUN_120H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_BUN, MIN(L.VALUENUM) as MIN_BUN,
	MAX(L.VALUENUM) as MAX_BUN,
	COUNT(L.VALUENUM) as COUNT_BUN
INTO FEATURES_ISA.BUN_120H
FROM ISABELA.DCW120H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '120 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51006 --BLOOD UREA NITROGEN 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.CHLORIDE_120H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_CHLORIDE, MIN(L.VALUENUM) as MIN_CHLORIDE,
	MAX(L.VALUENUM) as MAX_CHLORIDE, COUNT(L.VALUENUM) as COUNT_CHLORIDE
INTO FEATURES_ISA.CHLORIDE_120H
FROM ISABELA.DCW120H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '120 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID in (50902, 50806)  -- CHLORIDE, 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.CREATININE_120H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_SCR, MIN(L.VALUENUM) as MIN_SCR,
	MAX(L.VALUENUM) as MAX_SCR, COUNT(L.VALUENUM) as COUNT_SCR
INTO FEATURES_ISA.CREATININE_120H
FROM ISABELA.DCW120H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '120 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 50912 --CREATININE, 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;
--25150

DROP TABLE IF EXISTS FEATURES_ISA.INR_120H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_INR, MIN(L.VALUENUM) as MIN_INR,
	MAX(L.VALUENUM) as MAX_INR, COUNT(L.VALUENUM) as COUNT_INR
INTO FEATURES_ISA.INR_120H
FROM ISABELA.DCW120H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '120 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51237 --INTERNATIONAL NORMALIZED RATIO 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.PLATELETS_120H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_PLATELETS, MIN(L.VALUENUM) as MIN_PLATELETS,
	MAX(L.VALUENUM) as MAX_PLATELETS, COUNT(L.VALUENUM) as COUNT_PLATELETS
INTO FEATURES_ISA.PLATELETS_120H
FROM ISABELA.DCW120H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '120 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51265 --PLATELETS
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.POTASSIUM_120H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_POTASSIUM, MIN(L.VALUENUM) as MIN_POTASSIUM,
	MAX(L.VALUENUM) as MAX_POTASSIUM, COUNT(L.VALUENUM) as COUNT_POTASSIUM
INTO FEATURES_ISA.POTASSIUM_120H
FROM ISABELA.DCW120H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '120 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID IN (50971, 50822) --POTASSIUM 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;
--25261

DROP TABLE IF EXISTS FEATURES_ISA.PTT_120H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_PTT, MIN(L.VALUENUM) as MIN_PTT,
	MAX(L.VALUENUM) as MAX_PTT, COUNT(L.VALUENUM) as COUNT_PTT
INTO FEATURES_ISA.PTT_120H
FROM ISABELA.DCW120H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '120 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51275 -- PARTIAL THROMBOBLASTIN TIME  
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;

DROP TABLE IF EXISTS FEATURES_ISA.WBC_120H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_WBC, MIN(L.VALUENUM) as MIN_WBC,
	MAX(L.VALUENUM) as MAX_WBC,  COUNT(L.VALUENUM) as COUNT_WBC
INTO FEATURES_ISA.WBC_120H
FROM ISABELA.DCW120H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '120 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID IN (51301, 51300)  --WHITE BLOOD COUNT
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.CALCIUM_120H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_CALCIUM, MIN(L.VALUENUM) as MIN_CALCIUM,
	MAX(L.VALUENUM) as MAX_CALCIUM, COUNT(L.VALUENUM) as COUNT_CALCIUM
INTO FEATURES_ISA.CALCIUM_120H
FROM ISABELA.DCW120H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '120 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 50893 -- CALCIUM
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;

--144H
DROP TABLE IF EXISTS FEATURES_ISA.BICARBONATE_144H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_BICARBONATE, MIN(L.VALUENUM) as MIN_BICARBONATE,
	MAX(L.VALUENUM) as MAX_BICARBONATE, COUNT(L.VALUENUM) as COUNT_BICARBONATE
INTO FEATURES_ISA.BICARBONATE_144H
FROM ISABELA.DCW144H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '144 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND    
	L.ITEMID = 50882 --BICARBONATE 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.BUN_144H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_BUN, MIN(L.VALUENUM) as MIN_BUN,
	MAX(L.VALUENUM) as MAX_BUN,
	COUNT(L.VALUENUM) as COUNT_BUN
INTO FEATURES_ISA.BUN_144H
FROM ISABELA.DCW144H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '144 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51006 --BLOOD UREA NITROGEN 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.CHLORIDE_144H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_CHLORIDE, MIN(L.VALUENUM) as MIN_CHLORIDE,
	MAX(L.VALUENUM) as MAX_CHLORIDE, COUNT(L.VALUENUM) as COUNT_CHLORIDE
INTO FEATURES_ISA.CHLORIDE_144H
FROM ISABELA.DCW144H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '144 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID in (50902, 50806)  -- CHLORIDE, 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.CREATININE_144H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_SCR, MIN(L.VALUENUM) as MIN_SCR,
	MAX(L.VALUENUM) as MAX_SCR, COUNT(L.VALUENUM) as COUNT_SCR
INTO FEATURES_ISA.CREATININE_144H
FROM ISABELA.DCW144H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '144 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 50912 --CREATININE, 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.INR_144H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_INR, MIN(L.VALUENUM) as MIN_INR,
	MAX(L.VALUENUM) as MAX_INR, COUNT(L.VALUENUM) as COUNT_INR
INTO FEATURES_ISA.INR_144H
FROM ISABELA.DCW144H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '144 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51237 --INTERNATIONAL NORMALIZED RATIO 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.PLATELETS_144H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_PLATELETS, MIN(L.VALUENUM) as MIN_PLATELETS,
	MAX(L.VALUENUM) as MAX_PLATELETS, COUNT(L.VALUENUM) as COUNT_PLATELETS
INTO FEATURES_ISA.PLATELETS_144H
FROM ISABELA.DCW144H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '144 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51265 --PLATELETS
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.POTASSIUM_144H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_POTASSIUM, MIN(L.VALUENUM) as MIN_POTASSIUM,
	MAX(L.VALUENUM) as MAX_POTASSIUM, COUNT(L.VALUENUM) as COUNT_POTASSIUM
INTO FEATURES_ISA.POTASSIUM_144H
FROM ISABELA.DCW144H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '144 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID IN (50971, 50822) --POTASSIUM 
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;
--25261

DROP TABLE IF EXISTS FEATURES_ISA.PTT_144H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_PTT, MIN(L.VALUENUM) as MIN_PTT,
	MAX(L.VALUENUM) as MAX_PTT, COUNT(L.VALUENUM) as COUNT_PTT
INTO FEATURES_ISA.PTT_144H
FROM ISABELA.DCW144H D JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '144 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 51275 -- PARTIAL THROMBOBLASTIN TIME  
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;

DROP TABLE IF EXISTS FEATURES_ISA.WBC_144H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_WBC, MIN(L.VALUENUM) as MIN_WBC,
	MAX(L.VALUENUM) as MAX_WBC,  COUNT(L.VALUENUM) as COUNT_WBC
INTO FEATURES_ISA.WBC_144H
FROM ISABELA.DCW144H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '144 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID IN (51301, 51300)  --WHITE BLOOD COUNT
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.CALCIUM_144H;
SELECT D.ICUSTAY_ID, ROUND(cast(AVG(L.VALUENUM)as NUMERIC),2) as AVG_CALCIUM, MIN(L.VALUENUM) as MIN_CALCIUM,
	MAX(L.VALUENUM) as MAX_CALCIUM, COUNT(L.VALUENUM) as COUNT_CALCIUM
INTO FEATURES_ISA.CALCIUM_144H
FROM ISABELA.DCW144H D  JOIN MIMIC_UNTOUCHED.LABEVENTS L on D.HADM_ID = L.HADM_ID
WHERE L.CHARTTIME < D.INTIME + INTERVAL '144 HOUR' AND
	L.CHARTTIME >= D.INTIME AND L.CHARTTIME <= D.OUTTIME AND  --MODIFICATO   
	L.ITEMID = 50893 -- CALCIUM
group by D.ICUSTAY_ID
order by D.ICUSTAY_ID;



DROP TABLE IF EXISTS FEATURES_ISA.ALL_LABDCW48;
SELECT W.ICUSTAY_ID, W.AKI_FLAG, BIC.AVG_BICARBONATE, BIC.MIN_BICARBONATE,BIC.MAX_BICARBONATE,BIC.COUNT_BICARBONATE,
 B.AVG_BUN, B.MIN_BUN,B.MAX_BUN,B.COUNT_BUN, CH.AVG_CHLORIDE, CH.MIN_CHLORIDE,CH.MAX_CHLORIDE,CH.COUNT_CHLORIDE,
 SCR.AVG_SCR, SCR.MIN_SCR,SCR.MAX_SCR,SCR.COUNT_SCR, I.AVG_INR, I.MIN_INR,I.MAX_INR,I.COUNT_INR, 
 PL.AVG_PLATELETS, PL.MIN_PLATELETS,PL.MAX_PLATELETS,PL.COUNT_PLATELETS,
 POT.AVG_POTASSIUM, POT.MIN_POTASSIUM,POT.MAX_POTASSIUM,POT.COUNT_POTASSIUM, 
 PTT.AVG_PTT, PTT.MIN_PTT,PTT.MAX_PTT,PTT.COUNT_PTT,WBC.AVG_WBC, WBC.MIN_WBC,WBC.MAX_WBC,WBC.COUNT_WBC, C.AVG_CALCIUM
 C.MIN_CALCIUM,C.MAX_CALCIUM,C.COUNT_CALCIUM
INTO FEATURES_ISA.ALL_LABDCW48
FROM FEATURES_ISA.BUN_48H B JOIN FEATURES_ISA.BICARBONATE_48H BIC on B.ICUSTAY_ID = BIC.ICUSTAY_ID
	JOIN FEATURES_ISA.CHLORIDE_48H CH ON B.ICUSTAY_ID = CH.ICUSTAY_ID
	JOIN FEATURES_ISA.CREATININE_48H SCR ON B.ICUSTAY_ID = SCR.ICUSTAY_ID
	JOIN FEATURES_ISA.INR_48H I ON SCR.ICUSTAY_ID = I.ICUSTAY_ID
	JOIN FEATURES_ISA.PLATELETS_48H PL ON I.ICUSTAY_ID = PL.ICUSTAY_ID
	JOIN FEATURES_ISA.POTASSIUM_48H POT ON B.ICUSTAY_ID = POT.ICUSTAY_ID
	JOIN FEATURES_ISA.PTT_48H PTT ON POT.ICUSTAY_ID = PTT.ICUSTAY_ID
	JOIN FEATURES_ISA.WBC_48H WBC ON POT.ICUSTAY_ID = WBC.ICUSTAY_ID
	JOIN FEATURES_ISA.CALCIUM_48H C ON POT.ICUSTAY_ID = C.ICUSTAY_ID
	JOIN ISABELA.DCW48H W ON C.ICUSTAY_ID = W.ICUSTAY_ID
ORDER BY  W.ICUSTAY_ID;
--8535

--PUT TOGETHER NOW THE LABS WITH THE PATIENTS
SELECT D.ICUSTAY_ID, D.AKI_FLAG, L.AVG_BICARBONATE, L.MIN_BICARBONATE,L.MAX_BICARBONATE,L.COUNT_BICARBONATE,
 L.AVG_BUN, L.MIN_BUN,L.MAX_BUN, L.COUNT_BUN, L.AVG_CHLORIDE, L.MIN_CHLORIDE,L.MAX_CHLORIDE,L.COUNT_CHLORIDE,
 L.AVG_SCR, L.MIN_SCR, L.MAX_SCR, L.COUNT_SCR, L.AVG_INR, L.MIN_INR,L.MAX_INR,L.COUNT_INR, 
 L.AVG_PLATELETS, L.MIN_PLATELETS, L.MAX_PLATELETS, L.COUNT_PLATELETS,
 L.AVG_POTASSIUM, L.MIN_POTASSIUM, L.MAX_POTASSIUM, L.COUNT_POTASSIUM, 
 L.AVG_PTT, L.MIN_PTT, L.MAX_PTT, L.COUNT_PTT, L.AVG_WBC, L.MIN_WBC, L.MAX_WBC, L.COUNT_WBC, 
L.AVG_CALCIUM, L.MIN_CALCIUM, L.MAX_CALCIUM, L.COUNT_CALCIUM
INTO ISABELA.LAB_DCW48
FROM FEATURES_ISA.ALL_LABDCW48 L JOIN ISABELA.DCW48H D ON L.ICUSTAY_ID = D.ICUSTAY_ID
ORDER BY D.ICUSTAY_ID;
--8535


---------------------------------------------------------------------------------------------------------------------------------------

DROP TABLE IF EXISTS FEATURES_ISA.ALL_LABDCW72;
SELECT W.ICUSTAY_ID, W.AKI_FLAG, BIC.AVG_BICARBONATE, BIC.MIN_BICARBONATE,BIC.MAX_BICARBONATE,BIC.COUNT_BICARBONATE,
 B.AVG_BUN, B.MIN_BUN,B.MAX_BUN,B.COUNT_BUN, CH.AVG_CHLORIDE, CH.MIN_CHLORIDE,CH.MAX_CHLORIDE,CH.COUNT_CHLORIDE,
 SCR.AVG_SCR, SCR.MIN_SCR,SCR.MAX_SCR,SCR.COUNT_SCR, I.AVG_INR, I.MIN_INR,I.MAX_INR,I.COUNT_INR, 
 PL.AVG_PLATELETS, PL.MIN_PLATELETS,PL.MAX_PLATELETS,PL.COUNT_PLATELETS,
 POT.AVG_POTASSIUM, POT.MIN_POTASSIUM,POT.MAX_POTASSIUM,POT.COUNT_POTASSIUM, 
 PTT.AVG_PTT, PTT.MIN_PTT,PTT.MAX_PTT,PTT.COUNT_PTT,WBC.AVG_WBC, WBC.MIN_WBC,WBC.MAX_WBC,WBC.COUNT_WBC, 
 C.AVG_CALCIUM, C.MIN_CALCIUM,C.MAX_CALCIUM,C.COUNT_CALCIUM
INTO FEATURES_ISA.ALL_LABDCW72
FROM FEATURES_ISA.BUN_72H B JOIN FEATURES_ISA.BICARBONATE_72H BIC on B.ICUSTAY_ID = BIC.ICUSTAY_ID
	JOIN FEATURES_ISA.CHLORIDE_72H CH ON B.ICUSTAY_ID = CH.ICUSTAY_ID
	JOIN FEATURES_ISA.CREATININE_72H SCR ON B.ICUSTAY_ID = SCR.ICUSTAY_ID
	JOIN FEATURES_ISA.INR_72H I ON SCR.ICUSTAY_ID = I.ICUSTAY_ID
	JOIN FEATURES_ISA.PLATELETS_72H PL ON I.ICUSTAY_ID = PL.ICUSTAY_ID
	JOIN FEATURES_ISA.POTASSIUM_72H POT ON B.ICUSTAY_ID = POT.ICUSTAY_ID
	JOIN FEATURES_ISA.PTT_72H PTT ON POT.ICUSTAY_ID = PTT.ICUSTAY_ID
	JOIN FEATURES_ISA.WBC_72H WBC ON POT.ICUSTAY_ID = WBC.ICUSTAY_ID
	JOIN FEATURES_ISA.CALCIUM_72H C ON POT.ICUSTAY_ID = C.ICUSTAY_ID
	JOIN ISABELA.DCW72H W ON C.ICUSTAY_ID = W.ICUSTAY_ID
ORDER BY  W.ICUSTAY_ID;
--4446

--PUT TOGETHER NOW THE LABS WITH THE PATIENTS
SELECT D.ICUSTAY_ID, D.AKI_FLAG, L.AVG_BICARBONATE, L.MIN_BICARBONATE,L.MAX_BICARBONATE,L.COUNT_BICARBONATE,
 L.AVG_BUN, L.MIN_BUN,L.MAX_BUN, L.COUNT_BUN, L.AVG_CHLORIDE, L.MIN_CHLORIDE,L.MAX_CHLORIDE,L.COUNT_CHLORIDE,
 L.AVG_SCR, L.MIN_SCR, L.MAX_SCR, L.COUNT_SCR, L.AVG_INR, L.MIN_INR,L.MAX_INR,L.COUNT_INR, 
 L.AVG_PLATELETS, L.MIN_PLATELETS, L.MAX_PLATELETS, L.COUNT_PLATELETS,
 L.AVG_POTASSIUM, L.MIN_POTASSIUM, L.MAX_POTASSIUM, L.COUNT_POTASSIUM, 
 L.AVG_PTT, L.MIN_PTT, L.MAX_PTT, L.COUNT_PTT, L.AVG_WBC, L.MIN_WBC, L.MAX_WBC, L.COUNT_WBC, 
 L.AVG_CALCIUM,L.MIN_CALCIUM, L.MAX_CALCIUM, L.COUNT_CALCIUM
INTO ISABELA.LAB_DCW72
FROM FEATURES_ISA.ALL_LABDCW72 L JOIN ISABELA.DCW72H D ON L.ICUSTAY_ID = D.ICUSTAY_ID
ORDER BY D.ICUSTAY_ID;
--4446

---------------------------------------------------------------------------------------------------------------------------------------

DROP TABLE IF EXISTS FEATURES_ISA.ALL_LABDCW96;
SELECT W.ICUSTAY_ID, W.AKI_FLAG, BIC.AVG_BICARBONATE, BIC.MIN_BICARBONATE,BIC.MAX_BICARBONATE,BIC.COUNT_BICARBONATE,
 B.AVG_BUN, B.MIN_BUN,B.MAX_BUN,B.COUNT_BUN, CH.AVG_CHLORIDE, CH.MIN_CHLORIDE,CH.MAX_CHLORIDE,CH.COUNT_CHLORIDE,
 SCR.AVG_SCR, SCR.MIN_SCR,SCR.MAX_SCR,SCR.COUNT_SCR, I.AVG_INR, I.MIN_INR,I.MAX_INR,I.COUNT_INR, 
 PL.AVG_PLATELETS, PL.MIN_PLATELETS,PL.MAX_PLATELETS,PL.COUNT_PLATELETS,
 POT.AVG_POTASSIUM, POT.MIN_POTASSIUM,POT.MAX_POTASSIUM,POT.COUNT_POTASSIUM, 
 PTT.AVG_PTT, PTT.MIN_PTT,PTT.MAX_PTT,PTT.COUNT_PTT,WBC.AVG_WBC, WBC.MIN_WBC,WBC.MAX_WBC,WBC.COUNT_WBC, 
 C.AVG_CALCIUM, C.MIN_CALCIUM,C.MAX_CALCIUM,C.COUNT_CALCIUM
INTO FEATURES_ISA.ALL_LABDCW96
FROM FEATURES_ISA.BUN_96H B JOIN FEATURES_ISA.BICARBONATE_96H BIC on B.ICUSTAY_ID = BIC.ICUSTAY_ID
	JOIN FEATURES_ISA.CHLORIDE_96H CH ON B.ICUSTAY_ID = CH.ICUSTAY_ID
	JOIN FEATURES_ISA.CREATININE_96H SCR ON B.ICUSTAY_ID = SCR.ICUSTAY_ID
	JOIN FEATURES_ISA.INR_96H I ON SCR.ICUSTAY_ID = I.ICUSTAY_ID
	JOIN FEATURES_ISA.PLATELETS_96H PL ON I.ICUSTAY_ID = PL.ICUSTAY_ID
	JOIN FEATURES_ISA.POTASSIUM_96H POT ON B.ICUSTAY_ID = POT.ICUSTAY_ID
	JOIN FEATURES_ISA.PTT_96H PTT ON POT.ICUSTAY_ID = PTT.ICUSTAY_ID
	JOIN FEATURES_ISA.WBC_96H WBC ON POT.ICUSTAY_ID = WBC.ICUSTAY_ID
	JOIN FEATURES_ISA.CALCIUM_96H C ON POT.ICUSTAY_ID = C.ICUSTAY_ID
	JOIN ISABELA.DCW96H W ON C.ICUSTAY_ID = W.ICUSTAY_ID
ORDER BY  W.ICUSTAY_ID;
--2543

--PUT TOGETHER NOW THE LABS WITH THE PATIENTS
SELECT D.ICUSTAY_ID, D.AKI_FLAG, L.AVG_BICARBONATE, L.MIN_BICARBONATE,L.MAX_BICARBONATE,L.COUNT_BICARBONATE,
 L.AVG_BUN, L.MIN_BUN,L.MAX_BUN, L.COUNT_BUN, L.AVG_CHLORIDE, L.MIN_CHLORIDE,L.MAX_CHLORIDE,L.COUNT_CHLORIDE,
 L.AVG_SCR, L.MIN_SCR, L.MAX_SCR, L.COUNT_SCR, L.AVG_INR, L.MIN_INR,L.MAX_INR,L.COUNT_INR, 
 L.AVG_PLATELETS, L.MIN_PLATELETS, L.MAX_PLATELETS, L.COUNT_PLATELETS,
 L.AVG_POTASSIUM, L.MIN_POTASSIUM, L.MAX_POTASSIUM, L.COUNT_POTASSIUM, 
 L.AVG_PTT, L.MIN_PTT, L.MAX_PTT, L.COUNT_PTT, L.AVG_WBC, L.MIN_WBC, L.MAX_WBC, L.COUNT_WBC, 
 L.AVG_CALCIUM,L.MIN_CALCIUM, L.MAX_CALCIUM, L.COUNT_CALCIUM
INTO ISABELA.LAB_DCW96
FROM FEATURES_ISA.ALL_LABDCW96 L JOIN ISABELA.DCW96H D ON L.ICUSTAY_ID = D.ICUSTAY_ID
ORDER BY D.ICUSTAY_ID;
--2543
--------------------------------------------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS FEATURES_ISA.ALL_LABDCW120;
SELECT W.ICUSTAY_ID, W.AKI_FLAG, BIC.AVG_BICARBONATE, BIC.MIN_BICARBONATE,BIC.MAX_BICARBONATE,BIC.COUNT_BICARBONATE,
 B.AVG_BUN, B.MIN_BUN,B.MAX_BUN,B.COUNT_BUN, CH.AVG_CHLORIDE, CH.MIN_CHLORIDE,CH.MAX_CHLORIDE,CH.COUNT_CHLORIDE,
 SCR.AVG_SCR, SCR.MIN_SCR,SCR.MAX_SCR,SCR.COUNT_SCR, I.AVG_INR, I.MIN_INR,I.MAX_INR,I.COUNT_INR, 
 PL.AVG_PLATELETS, PL.MIN_PLATELETS,PL.MAX_PLATELETS,PL.COUNT_PLATELETS,
 POT.AVG_POTASSIUM, POT.MIN_POTASSIUM,POT.MAX_POTASSIUM,POT.COUNT_POTASSIUM, 
 PTT.AVG_PTT, PTT.MIN_PTT,PTT.MAX_PTT,PTT.COUNT_PTT,WBC.AVG_WBC, WBC.MIN_WBC,WBC.MAX_WBC,WBC.COUNT_WBC, 
 C.AVG_CALCIUM,C.MIN_CALCIUM,C.MAX_CALCIUM,C.COUNT_CALCIUM
INTO FEATURES_ISA.ALL_LABDCW120
FROM FEATURES_ISA.BUN_120H B JOIN FEATURES_ISA.BICARBONATE_120H BIC on B.ICUSTAY_ID = BIC.ICUSTAY_ID
	JOIN FEATURES_ISA.CHLORIDE_120H CH ON B.ICUSTAY_ID = CH.ICUSTAY_ID
	JOIN FEATURES_ISA.CREATININE_120H SCR ON B.ICUSTAY_ID = SCR.ICUSTAY_ID
	JOIN FEATURES_ISA.INR_120H I ON SCR.ICUSTAY_ID = I.ICUSTAY_ID
	JOIN FEATURES_ISA.PLATELETS_120H PL ON I.ICUSTAY_ID = PL.ICUSTAY_ID
	JOIN FEATURES_ISA.POTASSIUM_120H POT ON B.ICUSTAY_ID = POT.ICUSTAY_ID
	JOIN FEATURES_ISA.PTT_120H PTT ON POT.ICUSTAY_ID = PTT.ICUSTAY_ID
	JOIN FEATURES_ISA.WBC_120H WBC ON POT.ICUSTAY_ID = WBC.ICUSTAY_ID
	JOIN FEATURES_ISA.CALCIUM_120H C ON POT.ICUSTAY_ID = C.ICUSTAY_ID
	JOIN ISABELA.DCW120H W ON C.ICUSTAY_ID = W.ICUSTAY_ID
ORDER BY  W.ICUSTAY_ID;
--1656

--PUT TOGETHER NOW THE LABS WITH THE PATIENTS
SELECT D.ICUSTAY_ID, D.AKI_FLAG, L.AVG_BICARBONATE, L.MIN_BICARBONATE,L.MAX_BICARBONATE,L.COUNT_BICARBONATE,
 L.AVG_BUN, L.MIN_BUN,L.MAX_BUN, L.COUNT_BUN, L.AVG_CHLORIDE, L.MIN_CHLORIDE,L.MAX_CHLORIDE,L.COUNT_CHLORIDE,
 L.AVG_SCR, L.MIN_SCR, L.MAX_SCR, L.COUNT_SCR, L.AVG_INR, L.MIN_INR,L.MAX_INR,L.COUNT_INR, 
 L.AVG_PLATELETS, L.MIN_PLATELETS, L.MAX_PLATELETS, L.COUNT_PLATELETS,
 L.AVG_POTASSIUM, L.MIN_POTASSIUM, L.MAX_POTASSIUM, L.COUNT_POTASSIUM, 
 L.AVG_PTT, L.MIN_PTT, L.MAX_PTT, L.COUNT_PTT, L.AVG_WBC, L.MIN_WBC, L.MAX_WBC, L.COUNT_WBC, 
 L.AVG_CALCIUM,L.MIN_CALCIUM, L.MAX_CALCIUM, L.COUNT_CALCIUM
INTO ISABELA.LAB_DCW120
FROM FEATURES_ISA.ALL_LABDCW120 L JOIN ISABELA.DCW120H D ON L.ICUSTAY_ID = D.ICUSTAY_ID
ORDER BY D.ICUSTAY_ID;
--1656


--------------------------------------------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS FEATURES_ISA.ALL_LABDCW144;
SELECT W.ICUSTAY_ID, W.AKI_FLAG, BIC.AVG_BICARBONATE, BIC.MIN_BICARBONATE,BIC.MAX_BICARBONATE,BIC.COUNT_BICARBONATE,
 B.AVG_BUN, B.MIN_BUN,B.MAX_BUN,B.COUNT_BUN, CH.AVG_CHLORIDE, CH.MIN_CHLORIDE,CH.MAX_CHLORIDE,CH.COUNT_CHLORIDE,
 SCR.AVG_SCR, SCR.MIN_SCR,SCR.MAX_SCR,SCR.COUNT_SCR, I.AVG_INR, I.MIN_INR,I.MAX_INR,I.COUNT_INR, 
 PL.AVG_PLATELETS, PL.MIN_PLATELETS,PL.MAX_PLATELETS,PL.COUNT_PLATELETS,
 POT.AVG_POTASSIUM, POT.MIN_POTASSIUM,POT.MAX_POTASSIUM,POT.COUNT_POTASSIUM, 
 PTT.AVG_PTT, PTT.MIN_PTT,PTT.MAX_PTT,PTT.COUNT_PTT,WBC.AVG_WBC, WBC.MIN_WBC,WBC.MAX_WBC,WBC.COUNT_WBC, 
 C.AVG_CALCIUM,C.MIN_CALCIUM,C.MAX_CALCIUM,C.COUNT_CALCIUM
INTO FEATURES_ISA.ALL_LABDCW144
FROM FEATURES_ISA.BUN_144H B JOIN FEATURES_ISA.BICARBONATE_144H BIC on B.ICUSTAY_ID = BIC.ICUSTAY_ID
	JOIN FEATURES_ISA.CHLORIDE_144H CH ON B.ICUSTAY_ID = CH.ICUSTAY_ID
	JOIN FEATURES_ISA.CREATININE_144H SCR ON B.ICUSTAY_ID = SCR.ICUSTAY_ID
	JOIN FEATURES_ISA.INR_144H I ON SCR.ICUSTAY_ID = I.ICUSTAY_ID
	JOIN FEATURES_ISA.PLATELETS_144H PL ON I.ICUSTAY_ID = PL.ICUSTAY_ID
	JOIN FEATURES_ISA.POTASSIUM_144H POT ON B.ICUSTAY_ID = POT.ICUSTAY_ID
	JOIN FEATURES_ISA.PTT_144H PTT ON POT.ICUSTAY_ID = PTT.ICUSTAY_ID
	JOIN FEATURES_ISA.WBC_144H WBC ON POT.ICUSTAY_ID = WBC.ICUSTAY_ID
	JOIN FEATURES_ISA.CALCIUM_144H C ON POT.ICUSTAY_ID = C.ICUSTAY_ID
	JOIN ISABELA.DCW144H W ON C.ICUSTAY_ID = W.ICUSTAY_ID
ORDER BY  W.ICUSTAY_ID;
--1158

--PUT TOGETHER NOW THE LABS WITH THE PATIENTS
SELECT D.ICUSTAY_ID, D.AKI_FLAG, L.AVG_BICARBONATE, L.MIN_BICARBONATE,L.MAX_BICARBONATE,L.COUNT_BICARBONATE,
 L.AVG_BUN, L.MIN_BUN,L.MAX_BUN, L.COUNT_BUN, L.AVG_CHLORIDE, L.MIN_CHLORIDE,L.MAX_CHLORIDE,L.COUNT_CHLORIDE,
 L.AVG_SCR, L.MIN_SCR, L.MAX_SCR, L.COUNT_SCR, L.AVG_INR, L.MIN_INR,L.MAX_INR,L.COUNT_INR, 
 L.AVG_PLATELETS, L.MIN_PLATELETS, L.MAX_PLATELETS, L.COUNT_PLATELETS,
 L.AVG_POTASSIUM, L.MIN_POTASSIUM, L.MAX_POTASSIUM, L.COUNT_POTASSIUM, 
 L.AVG_PTT, L.MIN_PTT, L.MAX_PTT, L.COUNT_PTT, L.AVG_WBC, L.MIN_WBC, L.MAX_WBC, L.COUNT_WBC, 
 L.AVG_CALCIUM,L.MIN_CALCIUM, L.MAX_CALCIUM, L.COUNT_CALCIUM
INTO ISABELA.LAB_DCW144
FROM FEATURES_ISA.ALL_LABDCW144 L JOIN ISABELA.DCW144H D ON L.ICUSTAY_ID = D.ICUSTAY_ID
ORDER BY D.ICUSTAY_ID;
--1158


DROP TABLE IF EXISTS FEATURES_ISA.BICARBONATE_144H;
DROP TABLE IF EXISTS FEATURES_ISA.BUN_144H;
DROP TABLE IF EXISTS FEATURES_ISA.CHLORIDE_144H;
DROP TABLE IF EXISTS FEATURES_ISA.CREATININE_144H;
DROP TABLE IF EXISTS FEATURES_ISA.INR_144H;
DROP TABLE IF EXISTS FEATURES_ISA.PLATELETS_144H;
DROP TABLE IF EXISTS FEATURES_ISA.POTASSIUM_144H;
DROP TABLE IF EXISTS FEATURES_ISA.PTT_144H;
DROP TABLE IF EXISTS FEATURES_ISA.WBC_144H;
DROP TABLE IF EXISTS FEATURES_ISA.CALCIUM_144H;


------------------------------------------------------------------------------------------------------------------
--  CHARTEVENTS 
-----------------------------------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS FEATURES_ISA.HEART_RATE_48H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_HEART_RATE, MIN(C.VALUENUM) as MIN_HEART_RATE,
	MAX(C.VALUENUM) as MAX_HEART_RATE, COUNT(C.VALUENUM) as COUNT_HEART_RATE
INTO FEATURES_ISA.HEART_RATE_48H
FROM ISABELA.DCW48H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '48 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN (211, 220045) --HEART RATE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;
--25322

DROP TABLE IF EXISTS FEATURES_ISA.SYSBP_48H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_SYSBP, MIN(C.VALUENUM) as MIN_SYSBP,
	MAX(C.VALUENUM) as MAX_SYSBP, COUNT(C.VALUENUM) as COUNT_SYSBP
INTO FEATURES_ISA.SYSBP_48H
FROM ISABELA.DCW48H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '48 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 51, 442, 455, 6701, 220179,  220050) --SYSTOLIC BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;
--25311

DROP TABLE IF EXISTS FEATURES_ISA.DIASBP_48H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_DIASBP, MIN(C.VALUENUM) as MIN_DIASBP,
	MAX(C.VALUENUM) as MAX_DIASBP, COUNT(C.VALUENUM) as COUNT_DIASBP
INTO FEATURES_ISA.DIASBP_48H
FROM ISABELA.DCW48H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '48 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 8368, 8440, 8441, 8555, 220180, 220051) --DIASTOLIC BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;
--25307

DROP TABLE IF EXISTS FEATURES_ISA.MEANBP_48H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_MEANBP, MIN(C.VALUENUM) as MIN_MEANBP,
	MAX(C.VALUENUM) as MAX_MEANBP, COUNT(C.VALUENUM) as COUNT_MEANBP
INTO FEATURES_ISA.MEANBP_48H
FROM ISABELA.DCW48H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '48 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 456, 52, 6702, 443, 220052, 220181, 225312) --MEAN ARTERIAL BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;
--25321

DROP TABLE IF EXISTS FEATURES_ISA.RESPRATE_48H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_RESP, MIN(C.VALUENUM) as MIN_RESP,
	MAX(C.VALUENUM) as MAX_RESP, COUNT(C.VALUENUM) as COUNT_RESP
INTO FEATURES_ISA.RESPRATE_48H
FROM ISABELA.DCW48H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '48 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 618, 615, 220210, 224690) --RESPIRATION RATE 
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;
--25293

DROP TABLE IF EXISTS FEATURES_ISA.TEMP_48H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_TEMP, MIN(C.VALUENUM) as MIN_TEMP,
	MAX(C.VALUENUM) as MAX_TEMP, COUNT(C.VALUENUM) as COUNT_TEMP
INTO FEATURES_ISA.TEMP_48H
FROM ISABELA.DCW48H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '48 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 223762, 676, 223761, 678) --TEMPERATURE  
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;
--25015

DROP TABLE IF EXISTS FEATURES_ISA.SPO2_48H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_SPO2, MIN(C.VALUENUM) as MIN_SPO2,
	MAX(C.VALUENUM) as MAX_SPO2, COUNT(C.VALUENUM) as COUNT_SPO2
INTO FEATURES_ISA.SPO2_48H
FROM ISABELA.DCW48H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '48 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 646, 220277) --SPO2  
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;
--25314

DROP TABLE IF EXISTS FEATURES_ISA.GLUCOSE_48H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_GLUCOSE, MIN(C.VALUENUM) as MIN_GLUCOSE,
	MAX(C.VALUENUM) as MAX_GLUCOSE,COUNT(C.VALUENUM) as COUNT_GLUCOSE
INTO FEATURES_ISA.GLUCOSE_48H
FROM ISABELA.DCW48H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '48 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 807, 811, 1529, 3745,  3744, 225664, 220621, 226537) --GLUCOSE 
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;

--72H 
DROP TABLE IF EXISTS FEATURES_ISA.HEART_RATE_72H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_HEART_RATE, MIN(C.VALUENUM) as MIN_HEART_RATE,
	MAX(C.VALUENUM) as MAX_HEART_RATE, COUNT(C.VALUENUM) as COUNT_HEART_RATE
INTO FEATURES_ISA.HEART_RATE_72H
FROM ISABELA.DCW72H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '72 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN (211, 220045) --HEART RATE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.SYSBP_72H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_SYSBP, MIN(C.VALUENUM) as MIN_SYSBP,
	MAX(C.VALUENUM) as MAX_SYSBP, COUNT(C.VALUENUM) as COUNT_SYSBP
INTO FEATURES_ISA.SYSBP_72H
FROM ISABELA.DCW72H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '72 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 51, 442, 455, 6701, 220179,  220050) --SYSTOLIC BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.DIASBP_72H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_DIASBP, MIN(C.VALUENUM) as MIN_DIASBP,
	MAX(C.VALUENUM) as MAX_DIASBP, COUNT(C.VALUENUM) as COUNT_DIASBP
INTO FEATURES_ISA.DIASBP_72H
FROM ISABELA.DCW72H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '72 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 8368, 8440, 8441, 8555, 220180, 220051) --DIASTOLIC BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.MEANBP_72H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_MEANBP, MIN(C.VALUENUM) as MIN_MEANBP,
	MAX(C.VALUENUM) as MAX_MEANBP, COUNT(C.VALUENUM) as COUNT_MEANBP
INTO FEATURES_ISA.MEANBP_72H
FROM ISABELA.DCW72H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '72 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 456, 52, 6702, 443, 220052, 220181, 225312) --MEAN ARTERIAL BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.RESPRATE_72H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_RESP, MIN(C.VALUENUM) as MIN_RESP,
	MAX(C.VALUENUM) as MAX_RESP, COUNT(C.VALUENUM) as COUNT_RESP
INTO FEATURES_ISA.RESPRATE_72H
FROM ISABELA.DCW72H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '72 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 618, 615, 220210, 224690) --RESPIRATION RATE 
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.TEMP_72H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_TEMP, MIN(C.VALUENUM) as MIN_TEMP,
	MAX(C.VALUENUM) as MAX_TEMP, COUNT(C.VALUENUM) as COUNT_TEMP
INTO FEATURES_ISA.TEMP_72H
FROM ISABELA.DCW72H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '72 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 223762, 676, 223761, 678) --TEMPERATURE  
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.SPO2_72H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_SPO2, MIN(C.VALUENUM) as MIN_SPO2,
	MAX(C.VALUENUM) as MAX_SPO2, COUNT(C.VALUENUM) as COUNT_SPO2
INTO FEATURES_ISA.SPO2_72H
FROM ISABELA.DCW72H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '72 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 646, 220277) --SPO2  
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.GLUCOSE_72H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_GLUCOSE, MIN(C.VALUENUM) as MIN_GLUCOSE,
	MAX(C.VALUENUM) as MAX_GLUCOSE,COUNT(C.VALUENUM) as COUNT_GLUCOSE
INTO FEATURES_ISA.GLUCOSE_72H
FROM ISABELA.DCW72H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '72 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 807, 811, 1529, 3745,  3744, 225664, 220621, 226537) --GLUCOSE 
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


--96H 

DROP TABLE IF EXISTS FEATURES_ISA.HEART_RATE_96H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_HEART_RATE, MIN(C.VALUENUM) as MIN_HEART_RATE,
	MAX(C.VALUENUM) as MAX_HEART_RATE, COUNT(C.VALUENUM) as COUNT_HEART_RATE
INTO FEATURES_ISA.HEART_RATE_96H
FROM ISABELA.DCW96H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '96 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN (211, 220045) --HEART RATE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.SYSBP_96H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_SYSBP, MIN(C.VALUENUM) as MIN_SYSBP,
	MAX(C.VALUENUM) as MAX_SYSBP, COUNT(C.VALUENUM) as COUNT_SYSBP
INTO FEATURES_ISA.SYSBP_96H
FROM ISABELA.DCW96H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '96 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 51, 442, 455, 6701, 220179,  220050) --SYSTOLIC BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.DIASBP_96H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_DIASBP, MIN(C.VALUENUM) as MIN_DIASBP,
	MAX(C.VALUENUM) as MAX_DIASBP, COUNT(C.VALUENUM) as COUNT_DIASBP
INTO FEATURES_ISA.DIASBP_96H
FROM ISABELA.DCW96H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '96 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 8368, 8440, 8441, 8555, 220180, 220051) --DIASTOLIC BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.MEANBP_96H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_MEANBP, MIN(C.VALUENUM) as MIN_MEANBP,
	MAX(C.VALUENUM) as MAX_MEANBP, COUNT(C.VALUENUM) as COUNT_MEANBP
INTO FEATURES_ISA.MEANBP_96H
FROM ISABELA.DCW96H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '96 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 456, 52, 6702, 443, 220052, 220181, 225312) --MEAN ARTERIAL BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.RESPRATE_96H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_RESP, MIN(C.VALUENUM) as MIN_RESP,
	MAX(C.VALUENUM) as MAX_RESP, COUNT(C.VALUENUM) as COUNT_RESP
INTO FEATURES_ISA.RESPRATE_96H
FROM ISABELA.DCW96H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '96 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 618, 615, 220210, 224690) --RESPIRATION RATE 
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.TEMP_96H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_TEMP, MIN(C.VALUENUM) as MIN_TEMP,
	MAX(C.VALUENUM) as MAX_TEMP, COUNT(C.VALUENUM) as COUNT_TEMP
INTO FEATURES_ISA.TEMP_96H
FROM ISABELA.DCW96H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '96 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 223762, 676, 223761, 678) --TEMPERATURE  
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.SPO2_96H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_SPO2, MIN(C.VALUENUM) as MIN_SPO2,
	MAX(C.VALUENUM) as MAX_SPO2, COUNT(C.VALUENUM) as COUNT_SPO2
INTO FEATURES_ISA.SPO2_96H
FROM ISABELA.DCW96H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '96 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 646, 220277) --SPO2  
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.GLUCOSE_96H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_GLUCOSE, MIN(C.VALUENUM) as MIN_GLUCOSE,
	MAX(C.VALUENUM) as MAX_GLUCOSE,COUNT(C.VALUENUM) as COUNT_GLUCOSE
INTO FEATURES_ISA.GLUCOSE_96H
FROM ISABELA.DCW96H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '96 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 807, 811, 1529, 3745,  3744, 225664, 220621, 226537) --GLUCOSE 
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


--120H

DROP TABLE IF EXISTS FEATURES_ISA.HEART_RATE_120H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_HEART_RATE, MIN(C.VALUENUM) as MIN_HEART_RATE,
	MAX(C.VALUENUM) as MAX_HEART_RATE, COUNT(C.VALUENUM) as COUNT_HEART_RATE
INTO FEATURES_ISA.HEART_RATE_120H
FROM ISABELA.DCW120H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '120 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN (211, 220045) --HEART RATE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.SYSBP_120H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_SYSBP, MIN(C.VALUENUM) as MIN_SYSBP,
	MAX(C.VALUENUM) as MAX_SYSBP, COUNT(C.VALUENUM) as COUNT_SYSBP
INTO FEATURES_ISA.SYSBP_120H
FROM ISABELA.DCW120H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '120 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 51, 442, 455, 6701, 220179,  220050) --SYSTOLIC BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.DIASBP_120H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_DIASBP, MIN(C.VALUENUM) as MIN_DIASBP,
	MAX(C.VALUENUM) as MAX_DIASBP, COUNT(C.VALUENUM) as COUNT_DIASBP
INTO FEATURES_ISA.DIASBP_120H
FROM ISABELA.DCW120H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '120 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 8368, 8440, 8441, 8555, 220180, 220051) --DIASTOLIC BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.MEANBP_120H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_MEANBP, MIN(C.VALUENUM) as MIN_MEANBP,
	MAX(C.VALUENUM) as MAX_MEANBP, COUNT(C.VALUENUM) as COUNT_MEANBP
INTO FEATURES_ISA.MEANBP_120H
FROM ISABELA.DCW120H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '120 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 456, 52, 6702, 443, 220052, 220181, 225312) --MEAN ARTERIAL BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.RESPRATE_120H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_RESP, MIN(C.VALUENUM) as MIN_RESP,
	MAX(C.VALUENUM) as MAX_RESP, COUNT(C.VALUENUM) as COUNT_RESP
INTO FEATURES_ISA.RESPRATE_120H
FROM ISABELA.DCW120H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '120 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 618, 615, 220210, 224690) --RESPIRATION RATE 
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.TEMP_120H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_TEMP, MIN(C.VALUENUM) as MIN_TEMP,
	MAX(C.VALUENUM) as MAX_TEMP, COUNT(C.VALUENUM) as COUNT_TEMP
INTO FEATURES_ISA.TEMP_120H
FROM ISABELA.DCW120H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '120 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 223762, 676, 223761, 678) --TEMPERATURE  
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.SPO2_120H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_SPO2, MIN(C.VALUENUM) as MIN_SPO2,
	MAX(C.VALUENUM) as MAX_SPO2, COUNT(C.VALUENUM) as COUNT_SPO2
INTO FEATURES_ISA.SPO2_120H
FROM ISABELA.DCW120H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '120 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 646, 220277) --SPO2  
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.GLUCOSE_120H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_GLUCOSE, MIN(C.VALUENUM) as MIN_GLUCOSE,
	MAX(C.VALUENUM) as MAX_GLUCOSE,COUNT(C.VALUENUM) as COUNT_GLUCOSE
INTO FEATURES_ISA.GLUCOSE_120H
FROM ISABELA.DCW120H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '120 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 807, 811, 1529, 3745,  3744, 225664, 220621, 226537) --GLUCOSE 
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


--144H 

DROP TABLE IF EXISTS FEATURES_ISA.HEART_RATE_144H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_HEART_RATE, MIN(C.VALUENUM) as MIN_HEART_RATE,
	MAX(C.VALUENUM) as MAX_HEART_RATE, COUNT(C.VALUENUM) as COUNT_HEART_RATE
INTO FEATURES_ISA.HEART_RATE_144H
FROM ISABELA.DCW144H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '144 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN (211, 220045) --HEART RATE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.SYSBP_144H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_SYSBP, MIN(C.VALUENUM) as MIN_SYSBP,
	MAX(C.VALUENUM) as MAX_SYSBP, COUNT(C.VALUENUM) as COUNT_SYSBP
INTO FEATURES_ISA.SYSBP_144H
FROM ISABELA.DCW144H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '144 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 51, 442, 455, 6701, 220179,  220050) --SYSTOLIC BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.DIASBP_144H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_DIASBP, MIN(C.VALUENUM) as MIN_DIASBP,
	MAX(C.VALUENUM) as MAX_DIASBP, COUNT(C.VALUENUM) as COUNT_DIASBP
INTO FEATURES_ISA.DIASBP_144H
FROM ISABELA.DCW144H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '144 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 8368, 8440, 8441, 8555, 220180, 220051) --DIASTOLIC BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.MEANBP_144H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_MEANBP, MIN(C.VALUENUM) as MIN_MEANBP,
	MAX(C.VALUENUM) as MAX_MEANBP, COUNT(C.VALUENUM) as COUNT_MEANBP
INTO FEATURES_ISA.MEANBP_144H
FROM ISABELA.DCW144H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '144 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 456, 52, 6702, 443, 220052, 220181, 225312) --MEAN ARTERIAL BLOOD PRESSURE
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.RESPRATE_144H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_RESP, MIN(C.VALUENUM) as MIN_RESP,
	MAX(C.VALUENUM) as MAX_RESP, COUNT(C.VALUENUM) as COUNT_RESP
INTO FEATURES_ISA.RESPRATE_144H
FROM ISABELA.DCW144H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '144 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 618, 615, 220210, 224690) --RESPIRATION RATE 
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.TEMP_144H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_TEMP, MIN(C.VALUENUM) as MIN_TEMP,
	MAX(C.VALUENUM) as MAX_TEMP, COUNT(C.VALUENUM) as COUNT_TEMP
INTO FEATURES_ISA.TEMP_144H
FROM ISABELA.DCW144H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '144 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 223762, 676, 223761, 678) --TEMPERATURE  
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.SPO2_144H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_SPO2, MIN(C.VALUENUM) as MIN_SPO2,
	MAX(C.VALUENUM) as MAX_SPO2, COUNT(C.VALUENUM) as COUNT_SPO2
INTO FEATURES_ISA.SPO2_144H
FROM ISABELA.DCW144H F JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '144 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 646, 220277) --SPO2  
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;


DROP TABLE IF EXISTS FEATURES_ISA.GLUCOSE_144H;
SELECT F.ICUSTAY_ID, ROUND(cast(AVG(C.VALUENUM)as NUMERIC),2) as AVG_GLUCOSE, MIN(C.VALUENUM) as MIN_GLUCOSE,
	MAX(C.VALUENUM) as MAX_GLUCOSE,COUNT(C.VALUENUM) as COUNT_GLUCOSE
INTO FEATURES_ISA.GLUCOSE_144H
FROM ISABELA.DCW144H F  JOIN MIMIC_UNTOUCHED.CHARTEVENTS C on F.ICUSTAY_ID = C.ICUSTAY_ID
WHERE C.CHARTTIME < F.INTIME + INTERVAL '144 HOUR' AND
	C.CHARTTIME >= F.INTIME AND C.CHARTTIME <= F.OUTTIME AND  --MODIFICATO   
	C.ITEMID IN ( 807, 811, 1529, 3745,  3744, 225664, 220621, 226537) --GLUCOSE 
group by F.ICUSTAY_ID
order by F.ICUSTAY_ID;




DROP TABLE IF EXISTS FEATURES_ISA.ALL_CHARTDCW48;
SELECT W.ICUSTAY_ID, W.AKI_FLAG, MBP.AVG_MEANBP, MBP.MIN_MEANBP,MBP.MAX_MEANBP,MBP.COUNT_MEANBP,
 HR.AVG_HEART_RATE, HR.MIN_HEART_RATE,HR.MAX_HEART_RATE,HR.COUNT_HEART_RATE, SBP.AVG_SYSBP, SBP.MIN_SYSBP,SBP.MAX_SYSBP,SBP.COUNT_SYSBP,
 DBP.AVG_DIASBP,DBP.MIN_DIASBP,DBP.MAX_DIASBP,DBP.COUNT_DIASBP, R.AVG_RESP, R.MIN_RESP,R.MAX_RESP,R.COUNT_RESP, 
 T.AVG_TEMP, T.MIN_TEMP,T.MAX_TEMP,T.COUNT_TEMP,
 SP.AVG_SPO2, SP.MIN_SPO2,SP.MAX_SPO2,SP.COUNT_SPO2, 
 G.AVG_GLUCOSE, G.MIN_GLUCOSE,G.MAX_GLUCOSE,G.COUNT_GLUCOSE
INTO FEATURES_ISA.ALL_CHARTDCW48
FROM  FEATURES_ISA.MEANBP_48H MBP JOIN FEATURES_ISA.HEART_RATE_48H HR on MBP.ICUSTAY_ID = HR.ICUSTAY_ID
	JOIN FEATURES_ISA.SYSBP_48H SBP ON MBP.ICUSTAY_ID = SBP.ICUSTAY_ID
	JOIN FEATURES_ISA.DIASBP_48H DBP ON MBP.ICUSTAY_ID = DBP.ICUSTAY_ID
	JOIN FEATURES_ISA.RESPRATE_48H R ON MBP.ICUSTAY_ID = R.ICUSTAY_ID
	JOIN FEATURES_ISA.TEMP_48H T ON MBP.ICUSTAY_ID = T.ICUSTAY_ID
	JOIN FEATURES_ISA.SPO2_48H SP ON MBP.ICUSTAY_ID = SP.ICUSTAY_ID
	JOIN FEATURES_ISA.GLUCOSE_48H G ON MBP.ICUSTAY_ID = G.ICUSTAY_ID
	JOIN ISABELA.DCW48H W ON G.ICUSTAY_ID = W.ICUSTAY_ID
ORDER BY W.ICUSTAY_ID;


-- CREATE THE TABLE ON WHICHI THE PREDICTION SHOULD BE EPERFORMED: DCW24H JOIN ALL_CHARTDCW24
SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.AVG_MEANBP, C.MIN_MEANBP, C.MAX_MEANBP, C.COUNT_MEANBP,
 C.AVG_HEART_RATE, C.MIN_HEART_RATE, C.MAX_HEART_RATE, C.COUNT_HEART_RATE, C.AVG_SYSBP, C.MIN_SYSBP, C.MAX_SYSBP, C.COUNT_SYSBP,
 C.AVG_DIASBP, C.MIN_DIASBP, C.MAX_DIASBP, C.COUNT_DIASBP, C.AVG_RESP, C.MIN_RESP, C.MAX_RESP, C.COUNT_RESP, 
 C.AVG_TEMP, C.MIN_TEMP, C.MAX_TEMP, C.COUNT_TEMP,
 C.AVG_SPO2, C.MIN_SPO2, C.MAX_SPO2, C.COUNT_SPO2, 
 C.AVG_GLUCOSE, C.MIN_GLUCOSE, C.MAX_GLUCOSE, C.COUNT_GLUCOSE
INTO ISABELA.CHART_DCW48
FROM FEATURES_ISA.ALL_CHARTDCW48 C JOIN ISABELA.DCW48H D ON C.ICUSTAY_ID = D.ICUSTAY_ID
ORDER BY D.ICUSTAY_ID;


------------------------------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS FEATURES_ISA.ALL_CHARTDCW72;
SELECT W.ICUSTAY_ID, W.AKI_FLAG, MBP.AVG_MEANBP, MBP.MIN_MEANBP,MBP.MAX_MEANBP,MBP.COUNT_MEANBP,
 HR.AVG_HEART_RATE, HR.MIN_HEART_RATE,HR.MAX_HEART_RATE,HR.COUNT_HEART_RATE, SBP.AVG_SYSBP, SBP.MIN_SYSBP,SBP.MAX_SYSBP,SBP.COUNT_SYSBP,
 DBP.AVG_DIASBP,DBP.MIN_DIASBP,DBP.MAX_DIASBP,DBP.COUNT_DIASBP, R.AVG_RESP, R.MIN_RESP,R.MAX_RESP,R.COUNT_RESP, 
 T.AVG_TEMP, T.MIN_TEMP,T.MAX_TEMP,T.COUNT_TEMP,
 SP.AVG_SPO2, SP.MIN_SPO2,SP.MAX_SPO2,SP.COUNT_SPO2, 
 G.AVG_GLUCOSE, G.MIN_GLUCOSE,G.MAX_GLUCOSE,G.COUNT_GLUCOSE
INTO FEATURES_ISA.ALL_CHARTDCW72
FROM  FEATURES_ISA.MEANBP_72H MBP JOIN FEATURES_ISA.HEART_RATE_72H HR on MBP.ICUSTAY_ID = HR.ICUSTAY_ID
	JOIN FEATURES_ISA.SYSBP_72H SBP ON MBP.ICUSTAY_ID = SBP.ICUSTAY_ID
	JOIN FEATURES_ISA.DIASBP_72H DBP ON MBP.ICUSTAY_ID = DBP.ICUSTAY_ID
	JOIN FEATURES_ISA.RESPRATE_72H R ON MBP.ICUSTAY_ID = R.ICUSTAY_ID
	JOIN FEATURES_ISA.TEMP_72H T ON MBP.ICUSTAY_ID = T.ICUSTAY_ID
	JOIN FEATURES_ISA.SPO2_72H SP ON MBP.ICUSTAY_ID = SP.ICUSTAY_ID
	JOIN FEATURES_ISA.GLUCOSE_72H G ON MBP.ICUSTAY_ID = G.ICUSTAY_ID
	JOIN ISABELA.DCW72H W ON G.ICUSTAY_ID = W.ICUSTAY_ID
ORDER BY W.ICUSTAY_ID;


-- CREATE THE TABLE ON WHICHI THE PREDICTION SHOULD BE EPERFORMED: DCW24H JOIN ALL_CHARTDCW24
SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.AVG_MEANBP, C.MIN_MEANBP, C.MAX_MEANBP, C.COUNT_MEANBP,
 C.AVG_HEART_RATE, C.MIN_HEART_RATE, C.MAX_HEART_RATE, C.COUNT_HEART_RATE, C.AVG_SYSBP, C.MIN_SYSBP, C.MAX_SYSBP, C.COUNT_SYSBP,
 C.AVG_DIASBP, C.MIN_DIASBP, C.MAX_DIASBP, C.COUNT_DIASBP, C.AVG_RESP, C.MIN_RESP, C.MAX_RESP, C.COUNT_RESP, 
 C.AVG_TEMP, C.MIN_TEMP, C.MAX_TEMP, C.COUNT_TEMP,
 C.AVG_SPO2, C.MIN_SPO2, C.MAX_SPO2, C.COUNT_SPO2, 
 C.AVG_GLUCOSE, C.MIN_GLUCOSE, C.MAX_GLUCOSE, C.COUNT_GLUCOSE
INTO ISABELA.CHART_DCW72
FROM FEATURES_ISA.ALL_CHARTDCW72 C JOIN ISABELA.DCW72H D ON C.ICUSTAY_ID = D.ICUSTAY_ID
ORDER BY D.ICUSTAY_ID;


------------------------------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS FEATURES_ISA.ALL_CHARTDCW96;
SELECT W.ICUSTAY_ID, W.AKI_FLAG, MBP.AVG_MEANBP, MBP.MIN_MEANBP,MBP.MAX_MEANBP,MBP.COUNT_MEANBP,
 HR.AVG_HEART_RATE, HR.MIN_HEART_RATE,HR.MAX_HEART_RATE,HR.COUNT_HEART_RATE, SBP.AVG_SYSBP, SBP.MIN_SYSBP,SBP.MAX_SYSBP,SBP.COUNT_SYSBP,
 DBP.AVG_DIASBP,DBP.MIN_DIASBP,DBP.MAX_DIASBP,DBP.COUNT_DIASBP, R.AVG_RESP, R.MIN_RESP,R.MAX_RESP,R.COUNT_RESP, 
 T.AVG_TEMP, T.MIN_TEMP,T.MAX_TEMP,T.COUNT_TEMP,
 SP.AVG_SPO2, SP.MIN_SPO2,SP.MAX_SPO2,SP.COUNT_SPO2, 
 G.AVG_GLUCOSE, G.MIN_GLUCOSE,G.MAX_GLUCOSE,G.COUNT_GLUCOSE
INTO FEATURES_ISA.ALL_CHARTDCW96
FROM  FEATURES_ISA.MEANBP_96H MBP JOIN FEATURES_ISA.HEART_RATE_96H HR on MBP.ICUSTAY_ID = HR.ICUSTAY_ID
	JOIN FEATURES_ISA.SYSBP_96H SBP ON MBP.ICUSTAY_ID = SBP.ICUSTAY_ID
	JOIN FEATURES_ISA.DIASBP_96H DBP ON MBP.ICUSTAY_ID = DBP.ICUSTAY_ID
	JOIN FEATURES_ISA.RESPRATE_96H R ON MBP.ICUSTAY_ID = R.ICUSTAY_ID
	JOIN FEATURES_ISA.TEMP_96H T ON MBP.ICUSTAY_ID = T.ICUSTAY_ID
	JOIN FEATURES_ISA.SPO2_96H SP ON MBP.ICUSTAY_ID = SP.ICUSTAY_ID
	JOIN FEATURES_ISA.GLUCOSE_96H G ON MBP.ICUSTAY_ID = G.ICUSTAY_ID
	JOIN ISABELA.DCW96H W ON G.ICUSTAY_ID = W.ICUSTAY_ID
ORDER BY W.ICUSTAY_ID;


-- CREATE THE TABLE ON WHICHI THE PREDICTION SHOULD BE EPERFORMED: DCW24H JOIN ALL_CHARTDCW24
SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.AVG_MEANBP, C.MIN_MEANBP, C.MAX_MEANBP, C.COUNT_MEANBP,
 C.AVG_HEART_RATE, C.MIN_HEART_RATE, C.MAX_HEART_RATE, C.COUNT_HEART_RATE, C.AVG_SYSBP, C.MIN_SYSBP, C.MAX_SYSBP, C.COUNT_SYSBP,
 C.AVG_DIASBP, C.MIN_DIASBP, C.MAX_DIASBP, C.COUNT_DIASBP, C.AVG_RESP, C.MIN_RESP, C.MAX_RESP, C.COUNT_RESP, 
 C.AVG_TEMP, C.MIN_TEMP, C.MAX_TEMP, C.COUNT_TEMP,
 C.AVG_SPO2, C.MIN_SPO2, C.MAX_SPO2, C.COUNT_SPO2, 
 C.AVG_GLUCOSE, C.MIN_GLUCOSE, C.MAX_GLUCOSE, C.COUNT_GLUCOSE
INTO ISABELA.CHART_DCW96
FROM FEATURES_ISA.ALL_CHARTDCW96 C JOIN ISABELA.DCW96H D ON C.ICUSTAY_ID = D.ICUSTAY_ID
ORDER BY D.ICUSTAY_ID;


------------------------------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS FEATURES_ISA.ALL_CHARTDCW120;
SELECT W.ICUSTAY_ID, W.AKI_FLAG, MBP.AVG_MEANBP, MBP.MIN_MEANBP,MBP.MAX_MEANBP,MBP.COUNT_MEANBP,
 HR.AVG_HEART_RATE, HR.MIN_HEART_RATE,HR.MAX_HEART_RATE,HR.COUNT_HEART_RATE, SBP.AVG_SYSBP, SBP.MIN_SYSBP,SBP.MAX_SYSBP,SBP.COUNT_SYSBP,
 DBP.AVG_DIASBP,DBP.MIN_DIASBP,DBP.MAX_DIASBP,DBP.COUNT_DIASBP, R.AVG_RESP, R.MIN_RESP,R.MAX_RESP,R.COUNT_RESP, 
 T.AVG_TEMP, T.MIN_TEMP,T.MAX_TEMP,T.COUNT_TEMP,
 SP.AVG_SPO2, SP.MIN_SPO2,SP.MAX_SPO2,SP.COUNT_SPO2, 
 G.AVG_GLUCOSE, G.MIN_GLUCOSE,G.MAX_GLUCOSE,G.COUNT_GLUCOSE
INTO FEATURES_ISA.ALL_CHARTDCW120
FROM  FEATURES_ISA.MEANBP_120H MBP JOIN FEATURES_ISA.HEART_RATE_120H HR on MBP.ICUSTAY_ID = HR.ICUSTAY_ID
	JOIN FEATURES_ISA.SYSBP_120H SBP ON MBP.ICUSTAY_ID = SBP.ICUSTAY_ID
	JOIN FEATURES_ISA.DIASBP_120H DBP ON MBP.ICUSTAY_ID = DBP.ICUSTAY_ID
	JOIN FEATURES_ISA.RESPRATE_120H R ON MBP.ICUSTAY_ID = R.ICUSTAY_ID
	JOIN FEATURES_ISA.TEMP_120H T ON MBP.ICUSTAY_ID = T.ICUSTAY_ID
	JOIN FEATURES_ISA.SPO2_120H SP ON MBP.ICUSTAY_ID = SP.ICUSTAY_ID
	JOIN FEATURES_ISA.GLUCOSE_120H G ON MBP.ICUSTAY_ID = G.ICUSTAY_ID
	JOIN ISABELA.DCW120H W ON G.ICUSTAY_ID = W.ICUSTAY_ID
ORDER BY W.ICUSTAY_ID;


-- CREATE THE TABLE ON WHICHI THE PREDICTION SHOULD BE EPERFORMED: DCW24H JOIN ALL_CHARTDCW24
SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.AVG_MEANBP, C.MIN_MEANBP, C.MAX_MEANBP, C.COUNT_MEANBP,
 C.AVG_HEART_RATE, C.MIN_HEART_RATE, C.MAX_HEART_RATE, C.COUNT_HEART_RATE, C.AVG_SYSBP, C.MIN_SYSBP, C.MAX_SYSBP, C.COUNT_SYSBP,
 C.AVG_DIASBP, C.MIN_DIASBP, C.MAX_DIASBP, C.COUNT_DIASBP, C.AVG_RESP, C.MIN_RESP, C.MAX_RESP, C.COUNT_RESP, 
 C.AVG_TEMP, C.MIN_TEMP, C.MAX_TEMP, C.COUNT_TEMP,
 C.AVG_SPO2, C.MIN_SPO2, C.MAX_SPO2, C.COUNT_SPO2, 
 C.AVG_GLUCOSE, C.MIN_GLUCOSE, C.MAX_GLUCOSE, C.COUNT_GLUCOSE
INTO ISABELA.CHART_DCW120
FROM FEATURES_ISA.ALL_CHARTDCW120 C JOIN ISABELA.DCW120H D ON C.ICUSTAY_ID = D.ICUSTAY_ID
ORDER BY D.ICUSTAY_ID;


------------------------------------------------------------------------------------------------------------------------
DROP TABLE IF EXISTS FEATURES_ISA.ALL_CHARTDCW144;
SELECT W.ICUSTAY_ID, W.AKI_FLAG, MBP.AVG_MEANBP, MBP.MIN_MEANBP,MBP.MAX_MEANBP,MBP.COUNT_MEANBP,
 HR.AVG_HEART_RATE, HR.MIN_HEART_RATE,HR.MAX_HEART_RATE,HR.COUNT_HEART_RATE, SBP.AVG_SYSBP, SBP.MIN_SYSBP,SBP.MAX_SYSBP,SBP.COUNT_SYSBP,
 DBP.AVG_DIASBP,DBP.MIN_DIASBP,DBP.MAX_DIASBP,DBP.COUNT_DIASBP, R.AVG_RESP, R.MIN_RESP,R.MAX_RESP,R.COUNT_RESP, 
 T.AVG_TEMP, T.MIN_TEMP,T.MAX_TEMP,T.COUNT_TEMP,
 SP.AVG_SPO2, SP.MIN_SPO2,SP.MAX_SPO2,SP.COUNT_SPO2, 
 G.AVG_GLUCOSE, G.MIN_GLUCOSE,G.MAX_GLUCOSE,G.COUNT_GLUCOSE
INTO FEATURES_ISA.ALL_CHARTDCW144
FROM  FEATURES_ISA.MEANBP_144H MBP JOIN FEATURES_ISA.HEART_RATE_144H HR on MBP.ICUSTAY_ID = HR.ICUSTAY_ID
	JOIN FEATURES_ISA.SYSBP_144H SBP ON MBP.ICUSTAY_ID = SBP.ICUSTAY_ID
	JOIN FEATURES_ISA.DIASBP_144H DBP ON MBP.ICUSTAY_ID = DBP.ICUSTAY_ID
	JOIN FEATURES_ISA.RESPRATE_144H R ON MBP.ICUSTAY_ID = R.ICUSTAY_ID
	JOIN FEATURES_ISA.TEMP_144H T ON MBP.ICUSTAY_ID = T.ICUSTAY_ID
	JOIN FEATURES_ISA.SPO2_144H SP ON MBP.ICUSTAY_ID = SP.ICUSTAY_ID
	JOIN FEATURES_ISA.GLUCOSE_144H G ON MBP.ICUSTAY_ID = G.ICUSTAY_ID
	JOIN ISABELA.DCW144H W ON G.ICUSTAY_ID = W.ICUSTAY_ID
ORDER BY W.ICUSTAY_ID;


-- CREATE THE TABLE ON WHICHI THE PREDICTION SHOULD BE EPERFORMED: DCW24H JOIN ALL_CHARTDCW24
SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.AVG_MEANBP, C.MIN_MEANBP, C.MAX_MEANBP, C.COUNT_MEANBP,
 C.AVG_HEART_RATE, C.MIN_HEART_RATE, C.MAX_HEART_RATE, C.COUNT_HEART_RATE, C.AVG_SYSBP, C.MIN_SYSBP, C.MAX_SYSBP, C.COUNT_SYSBP,
 C.AVG_DIASBP, C.MIN_DIASBP, C.MAX_DIASBP, C.COUNT_DIASBP, C.AVG_RESP, C.MIN_RESP, C.MAX_RESP, C.COUNT_RESP, 
 C.AVG_TEMP, C.MIN_TEMP, C.MAX_TEMP, C.COUNT_TEMP,
 C.AVG_SPO2, C.MIN_SPO2, C.MAX_SPO2, C.COUNT_SPO2, 
 C.AVG_GLUCOSE, C.MIN_GLUCOSE, C.MAX_GLUCOSE, C.COUNT_GLUCOSE
INTO ISABELA.CHART_DCW144
FROM FEATURES_ISA.ALL_CHARTDCW144 C JOIN ISABELA.DCW144H D ON C.ICUSTAY_ID = D.ICUSTAY_ID
ORDER BY D.ICUSTAY_ID;


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- NOW VISUALIZE THE IDS HAVING ALL THE FEATURES. 
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT * 
INTO ISABELA.FEATURE_DCW24
FROM ISABELA.DCW24H D JOIN ISABELA.LAB_DCW24 L ON D.ICUSTAY_ID = L.ICUSTAY_ID
JOIN ISABELA.CHART_DCW24 C ON C.ICUSTAY_ID = D.ICUSTAY_ID
JOIN ISABELA.DEM_DCW24 DM ON D.ICUSTAY_ID = DM.ICUSTAY_ID
JOIN ISABELA.COM_DCW24 CM ON D.ICUSTAY_ID = CM.ICUSTAY_ID
JOIN ISABELA.MED_DCW24 M ON D.ICUSTAY_ID = M.ICUSTAY_ID;
--15282

-- ADESSO DEVO SALVARMI QUESTI PAZIENTI, E A PARTIRE DA QUESTI, DIVISI PER FEATURES FARE LA PREDIZIONE. QUESTI SONO QUELLI ELIGIBLE FINALI
-- DEVO SELEZIONARE LE FEATURES PER OGNI CATEGORIA. 
--24h 
DROP TABLE IF EXISTS PREDICTION_ISA.AUX_DCW24;
SELECT D.ICUSTAY_ID, D.AKI_FLAG 
INTO PREDICTION_ISA.AUX_DCW24
FROM ISABELA.DCW24H D JOIN ISABELA.LAB_DCW24 L ON D.ICUSTAY_ID = L.ICUSTAY_ID
JOIN ISABELA.CHART_DCW24 C ON C.ICUSTAY_ID = D.ICUSTAY_ID
JOIN ISABELA.DEM_DCW24 DM ON D.ICUSTAY_ID = DM.ICUSTAY_ID
JOIN ISABELA.COM_DCW24 CM ON D.ICUSTAY_ID = CM.ICUSTAY_ID
JOIN ISABELA.MED_DCW24 M ON D.ICUSTAY_ID = M.ICUSTAY_ID;
--15282

--48h
DROP TABLE IF EXISTS PREDICTION_ISA.AUX_DCW48;
SELECT D.ICUSTAY_ID, D.AKI_FLAG 
INTO PREDICTION_ISA.AUX_DCW48
FROM ISABELA.DCW48H D JOIN ISABELA.LAB_DCW48 L ON D.ICUSTAY_ID = L.ICUSTAY_ID
JOIN ISABELA.CHART_DCW48 C ON C.ICUSTAY_ID = D.ICUSTAY_ID
JOIN ISABELA.DEM_DCW48 DM ON D.ICUSTAY_ID = DM.ICUSTAY_ID
JOIN ISABELA.COM_DCW48 CM ON D.ICUSTAY_ID = CM.ICUSTAY_ID
JOIN ISABELA.MED_DCW48 M ON D.ICUSTAY_ID = M.ICUSTAY_ID;
--7862

--72h 
DROP TABLE IF EXISTS PREDICTION_ISA.AUX_DCW72;
SELECT D.ICUSTAY_ID, D.AKI_FLAG 
INTO PREDICTION_ISA.AUX_DCW72
FROM ISABELA.DCW72H D JOIN ISABELA.LAB_DCW72 L ON D.ICUSTAY_ID = L.ICUSTAY_ID
JOIN ISABELA.CHART_DCW72 C ON C.ICUSTAY_ID = D.ICUSTAY_ID
JOIN ISABELA.DEM_DCW72 DM ON D.ICUSTAY_ID = DM.ICUSTAY_ID
JOIN ISABELA.COM_DCW72 CM ON D.ICUSTAY_ID = CM.ICUSTAY_ID
JOIN ISABELA.MED_DCW72 M ON D.ICUSTAY_ID = M.ICUSTAY_ID;
--4052

--96h
DROP TABLE IF EXISTS PREDICTION_ISA.AUX_DCW96;
SELECT D.ICUSTAY_ID, D.AKI_FLAG 
INTO PREDICTION_ISA.AUX_DCW96
FROM ISABELA.DCW96H D JOIN ISABELA.LAB_DCW96 L ON D.ICUSTAY_ID = L.ICUSTAY_ID
JOIN ISABELA.CHART_DCW96 C ON C.ICUSTAY_ID = D.ICUSTAY_ID
JOIN ISABELA.DEM_DCW96 DM ON D.ICUSTAY_ID = DM.ICUSTAY_ID
JOIN ISABELA.COM_DCW96 CM ON D.ICUSTAY_ID = CM.ICUSTAY_ID
JOIN ISABELA.MED_DCW96 M ON D.ICUSTAY_ID = M.ICUSTAY_ID;
--2295

--120h
DROP TABLE IF EXISTS PREDICTION_ISA.AUX_DCW120;
SELECT D.ICUSTAY_ID, D.AKI_FLAG 
INTO PREDICTION_ISA.AUX_DCW120
FROM ISABELA.DCW120H D JOIN ISABELA.LAB_DCW120 L ON D.ICUSTAY_ID = L.ICUSTAY_ID
JOIN ISABELA.CHART_DCW120 C ON C.ICUSTAY_ID = D.ICUSTAY_ID
JOIN ISABELA.DEM_DCW120 DM ON D.ICUSTAY_ID = DM.ICUSTAY_ID
JOIN ISABELA.COM_DCW120 CM ON D.ICUSTAY_ID = CM.ICUSTAY_ID
JOIN ISABELA.MED_DCW120 M ON D.ICUSTAY_ID = M.ICUSTAY_ID;
--1467

--144h
DROP TABLE IF EXISTS PREDICTION_ISA.AUX_DCW144;
SELECT D.ICUSTAY_ID, D.AKI_FLAG 
INTO PREDICTION_ISA.AUX_DCW144
FROM ISABELA.DCW144H D JOIN ISABELA.LAB_DCW144 L ON D.ICUSTAY_ID = L.ICUSTAY_ID
JOIN ISABELA.CHART_DCW144 C ON C.ICUSTAY_ID = D.ICUSTAY_ID
JOIN ISABELA.DEM_DCW144 DM ON D.ICUSTAY_ID = DM.ICUSTAY_ID
JOIN ISABELA.COM_DCW144 CM ON D.ICUSTAY_ID = CM.ICUSTAY_ID
JOIN ISABELA.MED_DCW144 M ON D.ICUSTAY_ID = M.ICUSTAY_ID;
--1025


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- NOW EXTRACT FROM THESE AUX_TABLES THE IDS HAVING SPECIFIED FEATURES (CATEGORY). 
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--LABEVENTS 
SELECT D.ICUSTAY_ID, D.AKI_FLAG, L.AVG_BICARBONATE, L.MIN_BICARBONATE,L.MAX_BICARBONATE,L.COUNT_BICARBONATE,
 L.AVG_BUN, L.MIN_BUN,L.MAX_BUN, L.COUNT_BUN, L.AVG_CHLORIDE, L.MIN_CHLORIDE,L.MAX_CHLORIDE,L.COUNT_CHLORIDE,
 L.AVG_SCR, L.MIN_SCR, L.MAX_SCR, L.COUNT_SCR, L.AVG_INR, L.MIN_INR,L.MAX_INR,L.COUNT_INR, 
 L.AVG_PLATELETS, L.MIN_PLATELETS, L.MAX_PLATELETS, L.COUNT_PLATELETS,
 L.AVG_POTASSIUM, L.MIN_POTASSIUM, L.MAX_POTASSIUM, L.COUNT_POTASSIUM, 
 L.AVG_PTT, L.MIN_PTT, L.MAX_PTT, L.COUNT_PTT, L.AVG_WBC, L.MIN_WBC, L.MAX_WBC, L.COUNT_WBC, 
 L.AVG_CALCIUM, L.MIN_CALCIUM, L.MAX_CALCIUM, L.COUNT_CALCIUM
INTO PREDICTION_ISA.LAB24
FROM PREDICTION_ISA.AUX_DCW24 D JOIN ISABELA.LAB_DCW24 L ON D.ICUSTAY_ID = L.ICUSTAY_ID
--15282


SELECT D.ICUSTAY_ID, D.AKI_FLAG, L.AVG_BICARBONATE, L.MIN_BICARBONATE,L.MAX_BICARBONATE,L.COUNT_BICARBONATE,
 L.AVG_BUN, L.MIN_BUN,L.MAX_BUN, L.COUNT_BUN, L.AVG_CHLORIDE, L.MIN_CHLORIDE,L.MAX_CHLORIDE,L.COUNT_CHLORIDE,
 L.AVG_SCR, L.MIN_SCR, L.MAX_SCR, L.COUNT_SCR, L.AVG_INR, L.MIN_INR,L.MAX_INR,L.COUNT_INR, 
 L.AVG_PLATELETS, L.MIN_PLATELETS, L.MAX_PLATELETS, L.COUNT_PLATELETS,
 L.AVG_POTASSIUM, L.MIN_POTASSIUM, L.MAX_POTASSIUM, L.COUNT_POTASSIUM, 
 L.AVG_PTT, L.MIN_PTT, L.MAX_PTT, L.COUNT_PTT, L.AVG_WBC, L.MIN_WBC, L.MAX_WBC, L.COUNT_WBC, 
 L.AVG_CALCIUM,L.MIN_CALCIUM, L.MAX_CALCIUM, L.COUNT_CALCIUM
INTO PREDICTION_ISA.LAB48
FROM PREDICTION_ISA.AUX_DCW48 D JOIN ISABELA.LAB_DCW48 L ON D.ICUSTAY_ID = L.ICUSTAY_ID;
--7862

SELECT D.ICUSTAY_ID, D.AKI_FLAG, L.AVG_BICARBONATE, L.MIN_BICARBONATE,L.MAX_BICARBONATE,L.COUNT_BICARBONATE,
 L.AVG_BUN, L.MIN_BUN,L.MAX_BUN, L.COUNT_BUN, L.AVG_CHLORIDE, L.MIN_CHLORIDE,L.MAX_CHLORIDE,L.COUNT_CHLORIDE,
 L.AVG_SCR, L.MIN_SCR, L.MAX_SCR, L.COUNT_SCR, L.AVG_INR, L.MIN_INR,L.MAX_INR,L.COUNT_INR, 
 L.AVG_PLATELETS, L.MIN_PLATELETS, L.MAX_PLATELETS, L.COUNT_PLATELETS,
 L.AVG_POTASSIUM, L.MIN_POTASSIUM, L.MAX_POTASSIUM, L.COUNT_POTASSIUM, 
 L.AVG_PTT, L.MIN_PTT, L.MAX_PTT, L.COUNT_PTT, L.AVG_WBC, L.MIN_WBC, L.MAX_WBC, L.COUNT_WBC, 
 L.AVG_CALCIUM,L.MIN_CALCIUM, L.MAX_CALCIUM, L.COUNT_CALCIUM
INTO PREDICTION_ISA.LAB72
FROM PREDICTION_ISA.AUX_DCW72 D JOIN ISABELA.LAB_DCW72 L ON D.ICUSTAY_ID = L.ICUSTAY_ID;
--4052

SELECT D.ICUSTAY_ID, D.AKI_FLAG, L.AVG_BICARBONATE, L.MIN_BICARBONATE,L.MAX_BICARBONATE,L.COUNT_BICARBONATE,
 L.AVG_BUN, L.MIN_BUN,L.MAX_BUN, L.COUNT_BUN, L.AVG_CHLORIDE, L.MIN_CHLORIDE,L.MAX_CHLORIDE,L.COUNT_CHLORIDE,
 L.AVG_SCR, L.MIN_SCR, L.MAX_SCR, L.COUNT_SCR, L.AVG_INR, L.MIN_INR,L.MAX_INR,L.COUNT_INR, 
 L.AVG_PLATELETS, L.MIN_PLATELETS, L.MAX_PLATELETS, L.COUNT_PLATELETS,
 L.AVG_POTASSIUM, L.MIN_POTASSIUM, L.MAX_POTASSIUM, L.COUNT_POTASSIUM, 
 L.AVG_PTT, L.MIN_PTT, L.MAX_PTT, L.COUNT_PTT, L.AVG_WBC, L.MIN_WBC, L.MAX_WBC, L.COUNT_WBC, 
 L.AVG_CALCIUM,L.MIN_CALCIUM, L.MAX_CALCIUM, L.COUNT_CALCIUM
INTO PREDICTION_ISA.LAB96
FROM PREDICTION_ISA.AUX_DCW96 D JOIN ISABELA.LAB_DCW96 L ON D.ICUSTAY_ID = L.ICUSTAY_ID
--2295

SELECT D.ICUSTAY_ID, D.AKI_FLAG, L.AVG_BICARBONATE, L.MIN_BICARBONATE,L.MAX_BICARBONATE,L.COUNT_BICARBONATE,
 L.AVG_BUN, L.MIN_BUN,L.MAX_BUN, L.COUNT_BUN, L.AVG_CHLORIDE, L.MIN_CHLORIDE,L.MAX_CHLORIDE,L.COUNT_CHLORIDE,
 L.AVG_SCR, L.MIN_SCR, L.MAX_SCR, L.COUNT_SCR, L.AVG_INR, L.MIN_INR,L.MAX_INR,L.COUNT_INR, 
 L.AVG_PLATELETS, L.MIN_PLATELETS, L.MAX_PLATELETS, L.COUNT_PLATELETS,
 L.AVG_POTASSIUM, L.MIN_POTASSIUM, L.MAX_POTASSIUM, L.COUNT_POTASSIUM, 
 L.AVG_PTT, L.MIN_PTT, L.MAX_PTT, L.COUNT_PTT, L.AVG_WBC, L.MIN_WBC, L.MAX_WBC, L.COUNT_WBC, 
 L.AVG_CALCIUM,L.MIN_CALCIUM, L.MAX_CALCIUM, L.COUNT_CALCIUM
INTO PREDICTION_ISA.LAB120
FROM PREDICTION_ISA.AUX_DCW120 D JOIN ISABELA.LAB_DCW120 L ON D.ICUSTAY_ID = L.ICUSTAY_ID
--1467

SELECT D.ICUSTAY_ID, D.AKI_FLAG, L.AVG_BICARBONATE, L.MIN_BICARBONATE,L.MAX_BICARBONATE,L.COUNT_BICARBONATE,
 L.AVG_BUN, L.MIN_BUN,L.MAX_BUN, L.COUNT_BUN, L.AVG_CHLORIDE, L.MIN_CHLORIDE,L.MAX_CHLORIDE,L.COUNT_CHLORIDE,
 L.AVG_SCR, L.MIN_SCR, L.MAX_SCR, L.COUNT_SCR, L.AVG_INR, L.MIN_INR,L.MAX_INR,L.COUNT_INR, 
 L.AVG_PLATELETS, L.MIN_PLATELETS, L.MAX_PLATELETS, L.COUNT_PLATELETS,
 L.AVG_POTASSIUM, L.MIN_POTASSIUM, L.MAX_POTASSIUM, L.COUNT_POTASSIUM, 
 L.AVG_PTT, L.MIN_PTT, L.MAX_PTT, L.COUNT_PTT, L.AVG_WBC, L.MIN_WBC, L.MAX_WBC, L.COUNT_WBC, 
 L.AVG_CALCIUM,L.MIN_CALCIUM, L.MAX_CALCIUM, L.COUNT_CALCIUM
INTO PREDICTION_ISA.LAB144
FROM PREDICTION_ISA.AUX_DCW144 D JOIN ISABELA.LAB_DCW144 L ON D.ICUSTAY_ID = L.ICUSTAY_ID
--1025

--CHARTEVENTS 
SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.AVG_MEANBP, C.MIN_MEANBP, C.MAX_MEANBP, C.COUNT_MEANBP,
 C.AVG_HEART_RATE, C.MIN_HEART_RATE, C.MAX_HEART_RATE, C.COUNT_HEART_RATE, C.AVG_SYSBP, C.MIN_SYSBP, C.MAX_SYSBP, C.COUNT_SYSBP,
 C.AVG_DIASBP, C.MIN_DIASBP, C.MAX_DIASBP, C.COUNT_DIASBP, C.AVG_RESP, C.MIN_RESP, C.MAX_RESP, C.COUNT_RESP, 
 C.AVG_TEMP, C.MIN_TEMP, C.MAX_TEMP, C.COUNT_TEMP,
 C.AVG_SPO2, C.MIN_SPO2, C.MAX_SPO2, C.COUNT_SPO2, 
 C.AVG_GLUCOSE, C.MIN_GLUCOSE, C.MAX_GLUCOSE, C.COUNT_GLUCOSE
INTO PREDICTION_ISA.CHART24
FROM PREDICTION_ISA.AUX_DCW24 D 
JOIN ISABELA.CHART_DCW24 C ON D.ICUSTAY_ID = C.ICUSTAY_ID;
--15282

SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.AVG_MEANBP, C.MIN_MEANBP, C.MAX_MEANBP, C.COUNT_MEANBP,
 C.AVG_HEART_RATE, C.MIN_HEART_RATE, C.MAX_HEART_RATE, C.COUNT_HEART_RATE, C.AVG_SYSBP, C.MIN_SYSBP, C.MAX_SYSBP, C.COUNT_SYSBP,
 C.AVG_DIASBP, C.MIN_DIASBP, C.MAX_DIASBP, C.COUNT_DIASBP, C.AVG_RESP, C.MIN_RESP, C.MAX_RESP, C.COUNT_RESP, 
 C.AVG_TEMP, C.MIN_TEMP, C.MAX_TEMP, C.COUNT_TEMP,
 C.AVG_SPO2, C.MIN_SPO2, C.MAX_SPO2, C.COUNT_SPO2, 
 C.AVG_GLUCOSE, C.MIN_GLUCOSE, C.MAX_GLUCOSE, C.COUNT_GLUCOSE
INTO PREDICTION_ISA.CHART48
FROM PREDICTION_ISA.AUX_DCW48 D 
JOIN ISABELA.CHART_DCW48 C ON D.ICUSTAY_ID = C.ICUSTAY_ID;
--7862

SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.AVG_MEANBP, C.MIN_MEANBP, C.MAX_MEANBP, C.COUNT_MEANBP,
 C.AVG_HEART_RATE, C.MIN_HEART_RATE, C.MAX_HEART_RATE, C.COUNT_HEART_RATE, C.AVG_SYSBP, C.MIN_SYSBP, C.MAX_SYSBP, C.COUNT_SYSBP,
 C.AVG_DIASBP, C.MIN_DIASBP, C.MAX_DIASBP, C.COUNT_DIASBP, C.AVG_RESP, C.MIN_RESP, C.MAX_RESP, C.COUNT_RESP, 
 C.AVG_TEMP, C.MIN_TEMP, C.MAX_TEMP, C.COUNT_TEMP,
 C.AVG_SPO2, C.MIN_SPO2, C.MAX_SPO2, C.COUNT_SPO2, 
 C.AVG_GLUCOSE, C.MIN_GLUCOSE, C.MAX_GLUCOSE, C.COUNT_GLUCOSE
INTO PREDICTION_ISA.CHART72
FROM PREDICTION_ISA.AUX_DCW72 D 
JOIN ISABELA.CHART_DCW72 C ON D.ICUSTAY_ID = C.ICUSTAY_ID;
--4052

SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.AVG_MEANBP, C.MIN_MEANBP, C.MAX_MEANBP, C.COUNT_MEANBP,
 C.AVG_HEART_RATE, C.MIN_HEART_RATE, C.MAX_HEART_RATE, C.COUNT_HEART_RATE, C.AVG_SYSBP, C.MIN_SYSBP, C.MAX_SYSBP, C.COUNT_SYSBP,
 C.AVG_DIASBP, C.MIN_DIASBP, C.MAX_DIASBP, C.COUNT_DIASBP, C.AVG_RESP, C.MIN_RESP, C.MAX_RESP, C.COUNT_RESP, 
 C.AVG_TEMP, C.MIN_TEMP, C.MAX_TEMP, C.COUNT_TEMP,
 C.AVG_SPO2, C.MIN_SPO2, C.MAX_SPO2, C.COUNT_SPO2, 
 C.AVG_GLUCOSE, C.MIN_GLUCOSE, C.MAX_GLUCOSE, C.COUNT_GLUCOSE
INTO PREDICTION_ISA.CHART96
FROM PREDICTION_ISA.AUX_DCW96 D 
JOIN ISABELA.CHART_DCW96 C ON D.ICUSTAY_ID = C.ICUSTAY_ID;
--2295

SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.AVG_MEANBP, C.MIN_MEANBP, C.MAX_MEANBP, C.COUNT_MEANBP,
 C.AVG_HEART_RATE, C.MIN_HEART_RATE, C.MAX_HEART_RATE, C.COUNT_HEART_RATE, C.AVG_SYSBP, C.MIN_SYSBP, C.MAX_SYSBP, C.COUNT_SYSBP,
 C.AVG_DIASBP, C.MIN_DIASBP, C.MAX_DIASBP, C.COUNT_DIASBP, C.AVG_RESP, C.MIN_RESP, C.MAX_RESP, C.COUNT_RESP, 
 C.AVG_TEMP, C.MIN_TEMP, C.MAX_TEMP, C.COUNT_TEMP,
 C.AVG_SPO2, C.MIN_SPO2, C.MAX_SPO2, C.COUNT_SPO2, 
 C.AVG_GLUCOSE, C.MIN_GLUCOSE, C.MAX_GLUCOSE, C.COUNT_GLUCOSE
INTO PREDICTION_ISA.CHART120
FROM PREDICTION_ISA.AUX_DCW120 D 
JOIN ISABELA.CHART_DCW120 C ON D.ICUSTAY_ID = C.ICUSTAY_ID
--1467

SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.AVG_MEANBP, C.MIN_MEANBP, C.MAX_MEANBP, C.COUNT_MEANBP,
 C.AVG_HEART_RATE, C.MIN_HEART_RATE, C.MAX_HEART_RATE, C.COUNT_HEART_RATE, C.AVG_SYSBP, C.MIN_SYSBP, C.MAX_SYSBP, C.COUNT_SYSBP,
 C.AVG_DIASBP, C.MIN_DIASBP, C.MAX_DIASBP, C.COUNT_DIASBP, C.AVG_RESP, C.MIN_RESP, C.MAX_RESP, C.COUNT_RESP, 
 C.AVG_TEMP, C.MIN_TEMP, C.MAX_TEMP, C.COUNT_TEMP,
 C.AVG_SPO2, C.MIN_SPO2, C.MAX_SPO2, C.COUNT_SPO2, 
 C.AVG_GLUCOSE, C.MIN_GLUCOSE, C.MAX_GLUCOSE, C.COUNT_GLUCOSE
INTO PREDICTION_ISA.CHART144
FROM PREDICTION_ISA.AUX_DCW144 D 
JOIN ISABELA.CHART_DCW144 C ON D.ICUSTAY_ID = C.ICUSTAY_ID
--1025


--DEMOGRAPHICS
SELECT D.ICUSTAY_ID, D.AKI_FLAG, DM.GENDER, DM.ETHNICITY, DM.AGE
INTO PREDICTION_ISA.DEM24
FROM PREDICTION_ISA.AUX_DCW24 D 
JOIN ISABELA.DEM_DCW24 DM ON D.ICUSTAY_ID = DM.ICUSTAY_ID;
--15282

SELECT D.ICUSTAY_ID, D.AKI_FLAG, DM.GENDER, DM.ETHNICITY, DM.AGE
INTO PREDICTION_ISA.DEM48
FROM PREDICTION_ISA.AUX_DCW48 D 
JOIN ISABELA.DEM_DCW48 DM ON D.ICUSTAY_ID = DM.ICUSTAY_ID;
--7862

SELECT D.ICUSTAY_ID, D.AKI_FLAG, DM.GENDER, DM.ETHNICITY, DM.AGE
INTO PREDICTION_ISA.DEM72
FROM PREDICTION_ISA.AUX_DCW72 D 
JOIN ISABELA.DEM_DCW72 DM ON D.ICUSTAY_ID = DM.ICUSTAY_ID;
--4052

SELECT D.ICUSTAY_ID, D.AKI_FLAG, DM.GENDER, DM.ETHNICITY, DM.AGE
INTO PREDICTION_ISA.DEM96
FROM PREDICTION_ISA.AUX_DCW96 D 
JOIN ISABELA.DEM_DCW96 DM ON D.ICUSTAY_ID = DM.ICUSTAY_ID;
--2295

SELECT D.ICUSTAY_ID, D.AKI_FLAG, DM.GENDER, DM.ETHNICITY, DM.AGE
INTO PREDICTION_ISA.DEM120
FROM PREDICTION_ISA.AUX_DCW120 D 
JOIN ISABELA.DEM_DCW120 DM ON D.ICUSTAY_ID = DM.ICUSTAY_ID;
--1467

SELECT D.ICUSTAY_ID, D.AKI_FLAG, DM.GENDER, DM.ETHNICITY, DM.AGE
INTO PREDICTION_ISA.DEM144
FROM PREDICTION_ISA.AUX_DCW144 D 
JOIN ISABELA.DEM_DCW144 DM ON D.ICUSTAY_ID = DM.ICUSTAY_ID;
--1025


--COMORBIDITIES
SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.Congestive_heart_failure, C.Peripheral_vascular, 
C.Hypertension, C.Diabetes, C.Liver_diseases, C.Myocardial_infarction, 
C.Coronary_artery_disease, C.Cirrhosis, C.Jaundic
INTO PREDICTION_ISA.COM24
FROM PREDICTION_ISA.AUX_DCW24 D 
JOIN ISABELA.COM_DCW24 C ON D.ICUSTAY_ID = C.ICUSTAY_ID;
--STESSO NUMERO DEGLI ALTRI

SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.Congestive_heart_failure, C.Peripheral_vascular, 
C.Hypertension, C.Diabetes, C.Liver_diseases, C.Myocardial_infarction, 
C.Coronary_artery_disease, C.Cirrhosis, C.Jaundic
INTO PREDICTION_ISA.COM48
FROM PREDICTION_ISA.AUX_DCW48 D 
JOIN ISABELA.COM_DCW48 C ON D.ICUSTAY_ID = C.ICUSTAY_ID;

SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.Congestive_heart_failure, C.Peripheral_vascular, 
C.Hypertension, C.Diabetes, C.Liver_diseases, C.Myocardial_infarction, 
C.Coronary_artery_disease, C.Cirrhosis, C.Jaundic
INTO PREDICTION_ISA.COM72
FROM PREDICTION_ISA.AUX_DCW72 D 
JOIN ISABELA.COM_DCW72 C ON D.ICUSTAY_ID = C.ICUSTAY_ID;

SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.Congestive_heart_failure, C.Peripheral_vascular, 
C.Hypertension, C.Diabetes, C.Liver_diseases, C.Myocardial_infarction, 
C.Coronary_artery_disease, C.Cirrhosis, C.Jaundic
INTO PREDICTION_ISA.COM96
FROM PREDICTION_ISA.AUX_DCW96 D 
JOIN ISABELA.COM_DCW96 C ON D.ICUSTAY_ID = C.ICUSTAY_ID;

SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.Congestive_heart_failure, C.Peripheral_vascular, 
C.Hypertension, C.Diabetes, C.Liver_diseases, C.Myocardial_infarction, 
C.Coronary_artery_disease, C.Cirrhosis, C.Jaundic
INTO PREDICTION_ISA.COM120
FROM PREDICTION_ISA.AUX_DCW120 D 
JOIN ISABELA.COM_DCW120 C ON D.ICUSTAY_ID = C.ICUSTAY_ID;

SELECT D.ICUSTAY_ID, D.AKI_FLAG, C.Congestive_heart_failure, C.Peripheral_vascular, 
C.Hypertension, C.Diabetes, C.Liver_diseases, C.Myocardial_infarction, 
C.Coronary_artery_disease, C.Cirrhosis, C.Jaundic
INTO PREDICTION_ISA.COM144
FROM PREDICTION_ISA.AUX_DCW144 D 
JOIN ISABELA.COM_DCW144 C ON D.ICUSTAY_ID = C.ICUSTAY_ID;



--MEDICATIONS
SELECT D.ICUSTAY_ID, D.AKI_FLAG, M.RADIO, M.ANGIO, M.DIURETICS, M.NSAID
INTO PREDICTION_ISA.MED24
FROM PREDICTION_ISA.AUX_DCW24 D 
JOIN ISABELA.MED_DCW24 M ON D.ICUSTAY_ID = M.ICUSTAY_ID;

SELECT D.ICUSTAY_ID, D.AKI_FLAG, M.RADIO, M.ANGIO, M.DIURETICS, M.NSAID
INTO PREDICTION_ISA.MED48
FROM PREDICTION_ISA.AUX_DCW48 D 
JOIN ISABELA.MED_DCW48 M ON D.ICUSTAY_ID = M.ICUSTAY_ID;

SELECT D.ICUSTAY_ID, D.AKI_FLAG, M.RADIO, M.ANGIO, M.DIURETICS, M.NSAID
INTO PREDICTION_ISA.MED72
FROM PREDICTION_ISA.AUX_DCW72 D 
JOIN ISABELA.MED_DCW72 M ON D.ICUSTAY_ID = M.ICUSTAY_ID;

SELECT D.ICUSTAY_ID, D.AKI_FLAG, M.RADIO, M.ANGIO, M.DIURETICS, M.NSAID
INTO PREDICTION_ISA.MED96
FROM PREDICTION_ISA.AUX_DCW96 D 
JOIN ISABELA.MED_DCW96 M ON D.ICUSTAY_ID = M.ICUSTAY_ID;

SELECT D.ICUSTAY_ID, D.AKI_FLAG, M.RADIO, M.ANGIO, M.DIURETICS, M.NSAID
INTO PREDICTION_ISA.MED120
FROM PREDICTION_ISA.AUX_DCW120 D 
JOIN ISABELA.MED_DCW120 M ON D.ICUSTAY_ID = M.ICUSTAY_ID;

SELECT D.ICUSTAY_ID, D.AKI_FLAG, M.RADIO, M.ANGIO, M.DIURETICS, M.NSAID
INTO PREDICTION_ISA.MED144
FROM PREDICTION_ISA.AUX_DCW144 D 
JOIN ISABELA.MED_DCW144 M ON D.ICUSTAY_ID = M.ICUSTAY_ID;


--MEDICATIONS, COMORBIDITIES, DEMOGRAPHICS NO MISSING VALUES 
-- LABEVENTS MISSING FOR ATTRIBUTES: 
    --2 INR 
    --3 BICARB
    --4 PTT
    --1 POTASSIUM
--CHARTEVENTS ONLY 1 MISSING FOR  SPO2